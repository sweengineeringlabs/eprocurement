<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GovProcure Enterprise ‚Äî eProcurement with OCR</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=IBM+Plex+Sans:wght@300;400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --navy: #0d2145;
  --navy-mid: #163266;
  --navy-light: #1e4080;
  --blue: #1a5fce;
  --blue-light: #2d74e0;
  --accent: #c8973a;
  --accent-light: #e4b45a;
  --bg: #f4f5f7;
  --surface: #ffffff;
  --surface2: #f8f9fb;
  --border: #dde1ea;
  --border-strong: #c4cad8;
  --text: #0d1b2e;
  --text-mid: #3a4a62;
  --text-muted: #6b7a94;
  --green: #1a7a4a;
  --green-bg: #e8f5ee;
  --orange: #c26b12;
  --orange-bg: #fef3e2;
  --red: #c0392b;
  --red-bg: #fdecea;
  --blue-bg: #e8f0fd;
  --shadow-sm: 0 1px 3px rgba(13,33,69,0.06), 0 1px 2px rgba(13,33,69,0.04);
  --shadow: 0 4px 12px rgba(13,33,69,0.08), 0 1px 3px rgba(13,33,69,0.04);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Sans', sans-serif; min-height: 100vh; display: flex; }

/* SIDEBAR */
.sidebar { width: 240px; min-height: 100vh; background: var(--navy); display: flex; flex-direction: column; position: fixed; left: 0; top: 0; bottom: 0; z-index: 200; }
.sidebar-brand { padding: 0 24px; height: 64px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(255,255,255,0.08); }
.brand-emblem { width: 36px; height: 36px; background: var(--accent); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-family: 'Playfair Display', serif; font-weight: 700; font-size: 17px; color: var(--navy); }
.brand-name { font-weight: 600; font-size: 14px; color: #fff; line-height: 1.3; }
.brand-tagline { font-size: 10px; color: rgba(255,255,255,0.45); letter-spacing: 0.5px; }
.nav { flex: 1; padding: 20px 0; overflow-y: auto; }
.nav-section { font-size: 9.5px; font-weight: 600; letter-spacing: 1.5px; color: rgba(255,255,255,0.3); text-transform: uppercase; padding: 14px 24px 6px; }
.nav-item { display: flex; align-items: center; gap: 11px; padding: 9px 24px; cursor: pointer; font-size: 13px; color: rgba(255,255,255,0.62); transition: all 0.15s; border-left: 3px solid transparent; margin: 1px 0; }
.nav-item:hover { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.88); }
.nav-item.active { background: rgba(26,95,206,0.25); color: #fff; border-left-color: var(--accent); font-weight: 500; }
.nav-item svg { width: 15px; height: 15px; flex-shrink: 0; opacity: 0.8; }
.nav-item.active svg { opacity: 1; }
.nav-badge { margin-left: auto; background: var(--accent); color: var(--navy); font-size: 10px; font-weight: 700; padding: 1px 7px; border-radius: 3px; font-family: 'IBM Plex Mono', monospace; }
.nav-badge-new { margin-left: auto; background: var(--green); color: #fff; font-size: 9px; font-weight: 700; padding: 1px 6px; border-radius: 3px; letter-spacing: 0.5px; }
.sidebar-footer { padding: 16px 20px; border-top: 1px solid rgba(255,255,255,0.08); }
.user-card { display: flex; align-items: center; gap: 10px; }
.user-avatar { width: 34px; height: 34px; border-radius: 50%; background: var(--navy-light); border: 2px solid rgba(255,255,255,0.15); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: #fff; }
.user-name { font-size: 12.5px; font-weight: 500; color: #fff; }
.user-dept { font-size: 10.5px; color: rgba(255,255,255,0.4); }

/* MAIN */
.main { margin-left: 240px; flex: 1; display: flex; flex-direction: column; min-height: 100vh; }
.topbar { height: 64px; background: var(--surface); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 32px; gap: 16px; position: sticky; top: 0; z-index: 100; box-shadow: var(--shadow-sm); }
.topbar-left { flex: 1; }
.topbar-title { font-family: 'Playfair Display', serif; font-weight: 600; font-size: 19px; color: var(--navy); }
.topbar-breadcrumb { font-size: 11px; color: var(--text-muted); margin-top: 1px; }
.topbar-breadcrumb span { color: var(--blue); }
.topbar-actions { display: flex; align-items: center; gap: 10px; }
.search-box { display: flex; align-items: center; gap: 8px; background: var(--surface2); border: 1px solid var(--border); border-radius: 4px; padding: 0 12px; height: 34px; width: 220px; }
.search-box input { background: none; border: none; outline: none; font-size: 12.5px; font-family: 'IBM Plex Sans', sans-serif; color: var(--text); width: 100%; }
.search-box input::placeholder { color: var(--text-muted); }

.btn { padding: 7px 16px; border-radius: 4px; font-size: 12.5px; font-weight: 500; cursor: pointer; border: none; font-family: 'IBM Plex Sans', sans-serif; transition: all 0.15s; display: inline-flex; align-items: center; gap: 6px; }
.btn-primary { background: var(--blue); color: #fff; }
.btn-primary:hover { background: var(--navy-light); }
.btn-secondary { background: var(--surface); color: var(--text-mid); border: 1px solid var(--border-strong); }
.btn-secondary:hover { background: var(--surface2); border-color: var(--blue); color: var(--blue); }
.btn-accent { background: var(--accent); color: var(--navy); font-weight: 600; }
.btn-accent:hover { background: var(--accent-light); }
.btn-success { background: var(--green); color: #fff; }
.btn-success:hover { background: #15643d; }
.btn-sm { padding: 5px 12px; font-size: 11.5px; }
.btn-xs { padding: 3px 9px; font-size: 11px; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.icon-btn { width: 34px; height: 34px; border-radius: 4px; background: var(--surface2); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; color: var(--text-muted); transition: all 0.15s; }
.notif-dot { position: absolute; top: 5px; right: 5px; width: 6px; height: 6px; background: var(--red); border-radius: 50%; border: 1.5px solid var(--surface); }

/* PAGES */
.page { padding: 0; display: none; }
.page.active { display: block; animation: fadeIn 0.2s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }
.page-body { padding: 28px 32px; }

/* PANELS */
.panel { background: var(--surface); border: 1px solid var(--border); border-radius: 6px; box-shadow: var(--shadow-sm); overflow: hidden; margin-bottom: 20px; }
.panel-header { padding: 14px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; background: var(--surface2); }
.panel-title { font-size: 13px; font-weight: 600; color: var(--navy); }
.panel-body { padding: 20px; }

/* STATUS */
.status { display: inline-flex; align-items: center; gap: 5px; padding: 3px 10px; border-radius: 3px; font-size: 11px; font-weight: 600; }
.status::before { content: ''; width: 5px; height: 5px; border-radius: 50%; }
.status-approved { background: var(--green-bg); color: var(--green); }
.status-approved::before { background: var(--green); }
.status-pending { background: var(--orange-bg); color: var(--orange); }
.status-pending::before { background: var(--orange); }
.status-active { background: var(--blue-bg); color: var(--blue); }
.status-active::before { background: var(--blue); }
.status-rejected { background: var(--red-bg); color: var(--red); }
.status-rejected::before { background: var(--red); }

/* KPI */
.kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
.kpi-card { background: var(--surface); border: 1px solid var(--border); border-radius: 6px; padding: 20px 22px; box-shadow: var(--shadow-sm); position: relative; overflow: hidden; }
.kpi-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px; }
.kpi-card.blue::after { background: var(--blue); }
.kpi-card.gold::after { background: var(--accent); }
.kpi-card.green::after { background: var(--green); }
.kpi-card.purple::after { background: #7c3aed; }
.kpi-label { font-size: 10.5px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 10px; }
.kpi-value { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 600; color: var(--navy); margin-bottom: 6px; }
.kpi-delta { font-size: 11.5px; color: var(--text-muted); }
.kpi-delta .up { color: var(--green); font-weight: 600; }
.kpi-delta .dn { color: var(--orange); font-weight: 600; }
.kpi-icon { position: absolute; right: 18px; top: 18px; width: 36px; height: 36px; border-radius: 6px; display: flex; align-items: center; justify-content: center; }
.kpi-icon.blue { background: var(--blue-bg); color: var(--blue); }
.kpi-icon.gold { background: var(--orange-bg); color: var(--orange); }
.kpi-icon.green { background: var(--green-bg); color: var(--green); }
.kpi-icon.purple { background: #f0e8ff; color: #7c3aed; }

/* TABLE */
.data-table { width: 100%; border-collapse: collapse; }
.data-table thead th { padding: 10px 16px; text-align: left; font-size: 10.5px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; background: var(--surface2); border-bottom: 1px solid var(--border); }
.data-table tbody td { padding: 11px 16px; font-size: 12.5px; border-bottom: 1px solid var(--border); color: var(--text-mid); vertical-align: middle; }
.data-table tbody tr:last-child td { border-bottom: none; }
.data-table tbody tr:hover td { background: #f0f4ff; }
.id-cell { font-family: 'IBM Plex Mono', monospace; font-size: 11.5px; color: var(--blue); font-weight: 500; }
.mono { font-family: 'IBM Plex Mono', monospace; font-size: 12px; }

/* TABS */
.tab-bar { display: flex; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
.tab-item { padding: 10px 18px; font-size: 12.5px; font-weight: 500; cursor: pointer; color: var(--text-muted); border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; }
.tab-item:hover { color: var(--navy); }
.tab-item.active { color: var(--blue); border-bottom-color: var(--blue); font-weight: 600; }
.tab-count { margin-left: 5px; background: var(--blue-bg); color: var(--blue); font-size: 10px; font-weight: 700; padding: 1px 6px; border-radius: 3px; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   OCR SPECIFIC STYLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.ocr-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; align-items: start; }
.ocr-layout.full { grid-template-columns: 1fr; }

/* Drop Zone */
.drop-zone {
  border: 2px dashed var(--border-strong); border-radius: 8px; background: var(--surface2);
  padding: 48px 32px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative;
}
.drop-zone:hover, .drop-zone.dragover { border-color: var(--blue); background: var(--blue-bg); }
.drop-zone.has-file { border-color: var(--green); border-style: solid; background: var(--green-bg); }
.drop-icon { width: 56px; height: 56px; margin: 0 auto 16px; background: var(--blue-bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--blue); }
.drop-title { font-size: 15px; font-weight: 600; color: var(--navy); margin-bottom: 6px; }
.drop-sub { font-size: 12.5px; color: var(--text-muted); margin-bottom: 16px; line-height: 1.5; }
.drop-formats { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
.format-pill { background: var(--surface); border: 1px solid var(--border); border-radius: 3px; padding: 3px 10px; font-size: 11px; font-weight: 600; color: var(--text-muted); font-family: 'IBM Plex Mono', monospace; }
#fileInput { display: none; }

/* Preview area */
.doc-preview { background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
.doc-preview-header { padding: 10px 14px; background: var(--navy); color: #fff; font-size: 12px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
.doc-preview-body { padding: 0; max-height: 380px; overflow-y: auto; display: flex; align-items: center; justify-content: center; background: #525659; }
.doc-preview-body img { max-width: 100%; max-height: 380px; object-fit: contain; }
.doc-preview-placeholder { padding: 60px 20px; text-align: center; color: #aaa; font-size: 12.5px; }

/* Progress / Status */
.ocr-status-bar { background: var(--navy); border-radius: 6px; padding: 14px 18px; display: flex; align-items: center; gap: 14px; margin-bottom: 16px; }
.ocr-status-bar.success { background: var(--green); }
.ocr-status-bar.error { background: var(--red); }
.ocr-spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 0.8s linear infinite; flex-shrink: 0; }
@keyframes spin { to { transform: rotate(360deg); } }
.ocr-status-text { font-size: 13px; color: #fff; font-weight: 500; flex: 1; }
.ocr-status-sub { font-size: 11px; color: rgba(255,255,255,0.7); }

/* Extracted Fields */
.extracted-fields { display: flex; flex-direction: column; gap: 0; }
.field-row { display: flex; align-items: flex-start; padding: 10px 0; border-bottom: 1px solid var(--border); gap: 16px; }
.field-row:last-child { border-bottom: none; }
.field-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.6px; color: var(--text-muted); width: 160px; flex-shrink: 0; padding-top: 8px; }
.field-input-wrap { flex: 1; position: relative; }
.field-input-wrap input, .field-input-wrap select, .field-input-wrap textarea {
  width: 100%; background: var(--surface); border: 1px solid var(--border); border-radius: 4px;
  padding: 7px 12px; font-size: 13px; font-family: 'IBM Plex Sans', sans-serif; color: var(--text);
  outline: none; transition: border-color 0.15s;
}
.field-input-wrap input:focus, .field-input-wrap select:focus, .field-input-wrap textarea:focus { border-color: var(--blue); box-shadow: 0 0 0 3px rgba(26,95,206,0.1); }
.field-input-wrap textarea { min-height: 60px; resize: vertical; }
.field-confidence { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 10px; font-weight: 700; font-family: 'IBM Plex Mono', monospace; padding: 2px 6px; border-radius: 3px; }
.conf-high { background: var(--green-bg); color: var(--green); }
.conf-med { background: var(--orange-bg); color: var(--orange); }
.conf-low { background: var(--red-bg); color: var(--red); }
.field-verified { color: var(--green); font-size: 13px; }
.field-warning { color: var(--orange); font-size: 13px; }

/* Line items table editable */
.line-items-table { width: 100%; border-collapse: collapse; font-size: 12.5px; }
.line-items-table th { background: var(--surface2); border: 1px solid var(--border); padding: 8px 12px; text-align: left; font-size: 10.5px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.6px; color: var(--text-muted); }
.line-items-table td { border: 1px solid var(--border); padding: 6px 10px; vertical-align: middle; }
.line-items-table td input { width: 100%; border: none; outline: none; background: transparent; font-family: 'IBM Plex Sans', sans-serif; font-size: 12.5px; color: var(--text); }
.line-items-table td input:focus { background: var(--blue-bg); padding: 3px 6px; border-radius: 3px; }
.line-items-table tr.highlighted td { background: #fffbe6; }
.line-items-table tr.flagged td { background: var(--red-bg); }
.totals-row td { background: var(--surface2); font-weight: 600; }

/* OCR Log */
.ocr-log { background: var(--navy); border-radius: 6px; padding: 14px; font-family: 'IBM Plex Mono', monospace; font-size: 11.5px; color: #a8c4f0; max-height: 140px; overflow-y: auto; line-height: 1.7; }
.log-line { display: flex; gap: 12px; }
.log-time { color: rgba(168,196,240,0.5); flex-shrink: 0; }
.log-info { color: #a8c4f0; }
.log-success { color: #6ee7b7; }
.log-warn { color: #fcd34d; }
.log-error { color: #fca5a5; }

/* History table */
.history-badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 3px; font-size: 10.5px; font-weight: 600; }
.hb-invoice { background: #e8f0fd; color: var(--blue); }
.hb-po { background: var(--green-bg); color: var(--green); }
.hb-delivery { background: var(--orange-bg); color: var(--orange); }
.hb-quote { background: #f0e8ff; color: #7c3aed; }
.hb-contract { background: #fdecea; color: var(--red); }

/* Scan animation */
.scan-overlay { position: absolute; top: 0; left: 0; right: 0; pointer-events: none; }
.scan-line { height: 3px; background: linear-gradient(90deg, transparent, var(--blue), transparent); box-shadow: 0 0 12px var(--blue); animation: scanMove 2s ease-in-out infinite; }
@keyframes scanMove { 0% { margin-top: 0%; } 100% { margin-top: 100%; } }

/* Confidence meter */
.confidence-meter { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
.conf-bar-track { flex: 1; height: 6px; background: var(--border); border-radius: 99px; overflow: hidden; }
.conf-bar-fill { height: 100%; border-radius: 99px; transition: width 0.8s ease; }

/* Validation flags */
.validation-list { display: flex; flex-direction: column; gap: 8px; }
.validation-item { display: flex; align-items: flex-start; gap: 10px; padding: 10px 12px; border-radius: 4px; font-size: 12.5px; }
.validation-item.pass { background: var(--green-bg); color: var(--green); }
.validation-item.warn { background: var(--orange-bg); color: var(--orange); }
.validation-item.fail { background: var(--red-bg); color: var(--red); }
.validation-item svg { flex-shrink: 0; margin-top: 1px; }

/* Scrollbar */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 99px; }

/* Grid layouts */
.grid-3-2 { display: grid; grid-template-columns: 3fr 2fr; gap: 20px; }
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-brand">
    <div class="brand-emblem">G</div>
    <div>
      <div class="brand-name">GovProcure</div>
      <div class="brand-tagline">Enterprise Edition v4.2</div>
    </div>
  </div>
  <nav class="nav">
    <div class="nav-section">Main</div>
    <a class="nav-item" onclick="goto('dashboard',this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      Dashboard
    </a>
    <div class="nav-section">Procurement</div>
    <a class="nav-item" onclick="goto('ocr',this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
      OCR Document Scan
      <span class="nav-badge-new">NEW</span>
    </a>
    <a class="nav-item" onclick="goto('requisition',this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      Purchase Requests
      <span class="nav-badge">4</span>
    </a>
    <a class="nav-item" onclick="goto('bidding',this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      Bidding & Tenders
    </a>
    <a class="nav-item" onclick="goto('suppliers',this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>
      Supplier Management
    </a>
    <div class="nav-section">Finance</div>
    <a class="nav-item" onclick="goto('dashboard',this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
      Purchase Orders
    </a>
    <a class="nav-item" onclick="goto('dashboard',this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
      Invoice Management
    </a>
  </nav>
  <div class="sidebar-footer">
    <div class="user-card">
      <div class="user-avatar">TM</div>
      <div>
        <div class="user-name">Thabo Molefe</div>
        <div class="user-dept">Procurement Officer</div>
      </div>
    </div>
  </div>
</aside>

<main class="main">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: OCR DOCUMENT PROCESSING (MAIN FEATURE)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="ocr">
  <div class="topbar">
    <div class="topbar-left">
      <div class="topbar-title">OCR Document Processing</div>
      <div class="topbar-breadcrumb">Procurement &rsaquo; <span>Intelligent Document Scan</span> &rsaquo; Upload & Extract</div>
    </div>
    <div class="topbar-actions">
      <div class="search-box">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input placeholder="Search processed documents‚Ä¶" />
      </div>
      <div class="icon-btn">
        <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
        <div class="notif-dot"></div>
      </div>
      <button class="btn btn-accent btn-sm" onclick="resetOcr()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
        New Scan
      </button>
    </div>
  </div>

  <div class="page-body">
    <!-- KPIs -->
    <div class="kpi-row">
      <div class="kpi-card blue">
        <div class="kpi-icon blue">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
        </div>
        <div class="kpi-label">Docs Processed Today</div>
        <div class="kpi-value">47</div>
        <div class="kpi-delta"><span class="up">‚Üë 18%</span> vs yesterday</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-icon green">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <div class="kpi-label">Avg. Accuracy Rate</div>
        <div class="kpi-value">96.4%</div>
        <div class="kpi-delta"><span class="up">+1.2%</span> this week</div>
      </div>
      <div class="kpi-card gold">
        <div class="kpi-icon gold">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        </div>
        <div class="kpi-label">Avg. Processing Time</div>
        <div class="kpi-value">4.2s</div>
        <div class="kpi-delta">Per document</div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-icon purple">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        </div>
        <div class="kpi-label">Flagged for Review</div>
        <div class="kpi-value">3</div>
        <div class="kpi-delta"><span class="dn">Needs attention</span></div>
      </div>
    </div>

    <!-- MAIN OCR AREA -->
    <div id="uploadSection">
      <div class="grid-3-2" style="align-items:start;">
        <!-- LEFT: Upload + Preview -->
        <div>
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display:inline;margin-right:6px;vertical-align:middle"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                Upload Document for OCR Processing
              </div>
              <div style="display:flex;gap:6px;align-items:center;">
                <span style="font-size:11px;color:var(--text-muted)">Powered by Claude AI</span>
                <span style="width:8px;height:8px;border-radius:50%;background:var(--green);display:inline-block;"></span>
              </div>
            </div>
            <div class="panel-body">
              <!-- Document type selector -->
              <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
                <div class="doc-type-btn active" onclick="selectDocType(this,'invoice')" style="padding:6px 14px;border-radius:4px;font-size:12px;font-weight:600;cursor:pointer;background:var(--blue);color:#fff;border:1px solid var(--blue);">Invoice</div>
                <div class="doc-type-btn" onclick="selectDocType(this,'purchase_order')" style="padding:6px 14px;border-radius:4px;font-size:12px;font-weight:600;cursor:pointer;background:var(--surface);color:var(--text-muted);border:1px solid var(--border);">Purchase Order</div>
                <div class="doc-type-btn" onclick="selectDocType(this,'delivery_note')" style="padding:6px 14px;border-radius:4px;font-size:12px;font-weight:600;cursor:pointer;background:var(--surface);color:var(--text-muted);border:1px solid var(--border);">Delivery Note</div>
                <div class="doc-type-btn" onclick="selectDocType(this,'quotation')" style="padding:6px 14px;border-radius:4px;font-size:12px;font-weight:600;cursor:pointer;background:var(--surface);color:var(--text-muted);border:1px solid var(--border);">Quotation</div>
                <div class="doc-type-btn" onclick="selectDocType(this,'contract')" style="padding:6px 14px;border-radius:4px;font-size:12px;font-weight:600;cursor:pointer;background:var(--surface);color:var(--text-muted);border:1px solid var(--border);">Contract</div>
                <div class="doc-type-btn" onclick="selectDocType(this,'auto')" style="padding:6px 14px;border-radius:4px;font-size:12px;font-weight:600;cursor:pointer;background:var(--surface);color:var(--text-muted);border:1px solid var(--border);">Auto-Detect</div>
              </div>

              <input type="file" id="fileInput" accept="image/*,.pdf" onchange="handleFileSelect(event)" />

              <div class="drop-zone" id="dropZone"
                onclick="document.getElementById('fileInput').click()"
                ondragover="event.preventDefault();this.classList.add('dragover')"
                ondragleave="this.classList.remove('dragover')"
                ondrop="handleDrop(event)">
                <div class="drop-icon" id="dropIcon">
                  <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                </div>
                <div class="drop-title" id="dropTitle">Drag & drop your document here</div>
                <div class="drop-sub" id="dropSub">Or click to browse your files. Scanned PDFs, photos of documents, and image files are all supported.</div>
                <div class="drop-formats">
                  <span class="format-pill">PDF</span>
                  <span class="format-pill">JPG</span>
                  <span class="format-pill">PNG</span>
                  <span class="format-pill">TIFF</span>
                  <span class="format-pill">WEBP</span>
                </div>
              </div>

              <!-- Preview -->
              <div class="doc-preview" id="docPreview" style="margin-top:16px;display:none;">
                <div class="doc-preview-header">
                  <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                  <span id="previewFilename">document.jpg</span>
                  <span id="previewSize" style="margin-left:auto;opacity:0.6;font-size:10.5px;"></span>
                </div>
                <div class="doc-preview-body" id="previewBody">
                  <div class="doc-preview-placeholder">Preview loading‚Ä¶</div>
                </div>
              </div>

              <!-- Process button -->
              <div style="margin-top:16px;display:flex;gap:10px;align-items:center;" id="processRow" style="display:none!important">
                <button class="btn btn-primary" id="processBtn" onclick="processOCR()" disabled style="flex:1;justify-content:center;">
                  <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                  Process Document with AI OCR
                </button>
                <button class="btn btn-secondary btn-sm" onclick="resetOcr()">Clear</button>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT: Status + Log -->
        <div>
          <div class="panel">
            <div class="panel-header"><div class="panel-title">Processing Log</div><span id="logStatus" class="status status-active" style="display:none">Processing</span></div>
            <div class="panel-body" style="padding:14px;">
              <div class="ocr-log" id="ocrLog">
                <div class="log-line"><span class="log-time">09:14:02</span><span class="log-info">System ready. Awaiting document upload‚Ä¶</span></div>
              </div>
            </div>
          </div>

          <div class="panel" id="validationPanel" style="display:none;">
            <div class="panel-header"><div class="panel-title">Validation Results</div></div>
            <div class="panel-body" style="padding:14px;">
              <div class="validation-list" id="validationList"></div>
            </div>
          </div>

          <div class="panel">
            <div class="panel-header"><div class="panel-title">Supported Document Types</div></div>
            <div class="panel-body" style="padding:14px;">
              <div style="display:flex;flex-direction:column;gap:8px;">
                <div style="display:flex;align-items:center;gap:10px;font-size:12.5px;color:var(--text-mid);">
                  <span style="width:28px;height:28px;background:var(--blue-bg);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--blue);flex-shrink:0;">INV</span>
                  <div><div style="font-weight:500">Supplier Invoices</div><div style="font-size:11px;color:var(--text-muted)">VAT, line items, totals, banking details</div></div>
                </div>
                <div style="display:flex;align-items:center;gap:10px;font-size:12.5px;color:var(--text-mid);">
                  <span style="width:28px;height:28px;background:var(--green-bg);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--green);flex-shrink:0;">PO</span>
                  <div><div style="font-weight:500">Purchase Orders</div><div style="font-size:11px;color:var(--text-muted)">Vendor, items, quantities, pricing</div></div>
                </div>
                <div style="display:flex;align-items:center;gap:10px;font-size:12.5px;color:var(--text-mid);">
                  <span style="width:28px;height:28px;background:var(--orange-bg);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--orange);flex-shrink:0;">DN</span>
                  <div><div style="font-weight:500">Delivery Notes</div><div style="font-size:11px;color:var(--text-muted)">GRN matching, quantities, dates</div></div>
                </div>
                <div style="display:flex;align-items:center;gap:10px;font-size:12.5px;color:var(--text-mid);">
                  <span style="width:28px;height:28px;background:#f0e8ff;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#7c3aed;flex-shrink:0;">QT</span>
                  <div><div style="font-weight:500">Quotations & RFQ Responses</div><div style="font-size:11px;color:var(--text-muted)">Pricing, validity, terms</div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RESULTS SECTION (hidden until processed) -->
    <div id="resultsSection" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display:inline;margin-right:6px;vertical-align:middle;color:var(--green)"><polyline points="20 6 9 17 4 12"/></svg>
              Extracted Data ‚Äî <span id="resultDocType">Invoice</span>
            </div>
            <div style="font-size:11px;color:var(--text-muted);margin-top:2px;">Review and correct extracted fields before saving to the system</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;">
            <div class="confidence-meter" style="width:180px;">
              <span style="font-size:11px;color:var(--text-muted);white-space:nowrap">Confidence:</span>
              <div class="conf-bar-track"><div class="conf-bar-fill" id="confBar" style="width:0%;background:var(--green)"></div></div>
              <span class="mono" id="confPct" style="font-size:11px;font-weight:700;color:var(--green)">0%</span>
            </div>
            <span class="status status-approved" id="resultStatus">Extracted</span>
          </div>
        </div>
        <div class="panel-body">
          <div class="grid-3-2" style="align-items:start;gap:20px;">
            <!-- Extracted fields -->
            <div>
              <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);border-bottom:1px solid var(--border);padding-bottom:8px;margin-bottom:4px;">Document Header Fields</div>
              <div class="extracted-fields" id="extractedFields"></div>
            </div>
            <!-- Mini preview + actions -->
            <div style="display:flex;flex-direction:column;gap:14px;">
              <div id="miniPreview" style="background:var(--surface2);border:1px solid var(--border);border-radius:6px;overflow:hidden;">
                <div style="padding:8px 12px;background:var(--navy);color:#fff;font-size:11.5px;font-weight:500;">Scanned Document</div>
                <div style="padding:0;max-height:200px;overflow:hidden;background:#525659;display:flex;align-items:center;justify-content:center;" id="miniPreviewImg"></div>
              </div>
              <div style="display:flex;flex-direction:column;gap:8px;">
                <button class="btn btn-success" onclick="saveToSystem()" style="justify-content:center;">
                  <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                  Save to Procurement System
                </button>
                <button class="btn btn-secondary" style="justify-content:center;" onclick="resetOcr()">
                  <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
                  Scan Another Document
                </button>
                <button class="btn btn-secondary" style="justify-content:center;">
                  <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  Export as JSON
                </button>
              </div>
            </div>
          </div>

          <!-- Line items -->
          <div id="lineItemsSection" style="margin-top:20px;display:none;">
            <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);border-bottom:1px solid var(--border);padding-bottom:8px;margin-bottom:12px;">Extracted Line Items</div>
            <div style="overflow-x:auto;">
              <table class="line-items-table" id="lineItemsTable">
                <thead>
                  <tr>
                    <th>#</th><th>Description</th><th>Qty</th><th>Unit</th><th>Unit Price (ZAR)</th><th>VAT %</th><th>Line Total (ZAR)</th><th>Flag</th>
                  </tr>
                </thead>
                <tbody id="lineItemsBody"></tbody>
                <tfoot id="lineItemsFoot"></tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROCESSING HISTORY TABLE -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">Recent OCR Processing History</div>
        <button class="btn btn-secondary btn-sm">View All</button>
      </div>
      <table class="data-table">
        <thead>
          <tr>
            <th>Scan ID</th><th>Document Type</th><th>Supplier / Source</th>
            <th>Amount (ZAR)</th><th>Confidence</th><th>Processed By</th><th>Date & Time</th><th>Status</th><th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="id-cell">OCR-2026-0094</td>
            <td><span class="history-badge hb-invoice">Invoice</span></td>
            <td style="font-weight:500">Datacom Solutions</td>
            <td class="mono">R 124,500.00</td>
            <td><span style="color:var(--green);font-weight:700;font-family:'IBM Plex Mono',monospace;">98%</span></td>
            <td style="font-size:12px;color:var(--text-muted)">T. Molefe</td>
            <td style="font-size:12px;color:var(--text-muted)">26 Feb 2026, 08:41</td>
            <td><span class="status status-approved">Saved</span></td>
            <td><button class="btn btn-secondary btn-xs">Review</button></td>
          </tr>
          <tr>
            <td class="id-cell">OCR-2026-0093</td>
            <td><span class="history-badge hb-delivery">Delivery Note</span></td>
            <td style="font-weight:500">BuildRight Ltd</td>
            <td class="mono">‚Äî</td>
            <td><span style="color:var(--orange);font-weight:700;font-family:'IBM Plex Mono',monospace;">74%</span></td>
            <td style="font-size:12px;color:var(--text-muted)">S. Dlamini</td>
            <td style="font-size:12px;color:var(--text-muted)">25 Feb 2026, 15:22</td>
            <td><span class="status status-pending">Needs Review</span></td>
            <td><button class="btn btn-secondary btn-xs">Review</button></td>
          </tr>
          <tr>
            <td class="id-cell">OCR-2026-0092</td>
            <td><span class="history-badge hb-po">Purchase Order</span></td>
            <td style="font-weight:500">TechServ Group</td>
            <td class="mono">R 290,000.00</td>
            <td><span style="color:var(--green);font-weight:700;font-family:'IBM Plex Mono',monospace;">96%</span></td>
            <td style="font-size:12px;color:var(--text-muted)">T. Molefe</td>
            <td style="font-size:12px;color:var(--text-muted)">25 Feb 2026, 11:05</td>
            <td><span class="status status-approved">Saved</span></td>
            <td><button class="btn btn-secondary btn-xs">Review</button></td>
          </tr>
          <tr>
            <td class="id-cell">OCR-2026-0091</td>
            <td><span class="history-badge hb-quote">Quotation</span></td>
            <td style="font-weight:500">Apex Stationery</td>
            <td class="mono">R 8,200.00</td>
            <td><span style="color:var(--green);font-weight:700;font-family:'IBM Plex Mono',monospace;">99%</span></td>
            <td style="font-size:12px;color:var(--text-muted)">N. Khumalo</td>
            <td style="font-size:12px;color:var(--text-muted)">24 Feb 2026, 09:30</td>
            <td><span class="status status-approved">Saved</span></td>
            <td><button class="btn btn-secondary btn-xs">Review</button></td>
          </tr>
          <tr>
            <td class="id-cell">OCR-2026-0090</td>
            <td><span class="history-badge hb-contract">Contract</span></td>
            <td style="font-weight:500">Security Shield SA</td>
            <td class="mono">R 1,800,000.00</td>
            <td><span style="color:var(--red);font-weight:700;font-family:'IBM Plex Mono',monospace;">61%</span></td>
            <td style="font-size:12px;color:var(--text-muted)">S. Dlamini</td>
            <td style="font-size:12px;color:var(--text-muted)">24 Feb 2026, 08:14</td>
            <td><span class="status status-rejected">Failed</span></td>
            <td><button class="btn btn-secondary btn-xs">Re-scan</button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê OTHER SCREENS (MINIMAL STUBS) ‚ïê‚ïê‚ïê -->
<div class="page" id="dashboard">
  <div class="topbar">
    <div class="topbar-left"><div class="topbar-title">Dashboard</div><div class="topbar-breadcrumb">Home &rsaquo; <span>Overview</span></div></div>
    <div class="topbar-actions"><button class="btn btn-accent btn-sm" onclick="goto('ocr',document.querySelector('.nav-item:nth-child(3)'))">Try OCR ‚Üí</button></div>
  </div>
  <div class="page-body" style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;gap:20px;text-align:center;">
    <div style="width:64px;height:64px;background:var(--blue-bg);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--blue);">
      <svg width="30" height="30" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </div>
    <div style="font-family:'Playfair Display',serif;font-size:22px;color:var(--navy)">GovProcure Dashboard</div>
    <div style="font-size:13.5px;color:var(--text-muted);max-width:400px;line-height:1.6">This mockup focuses on the OCR Document Processing feature. Click <strong>OCR Document Scan</strong> in the sidebar to see the full working demo.</div>
    <button class="btn btn-primary" onclick="goto('ocr',null)">Go to OCR Document Scan ‚Üí</button>
  </div>
</div>

<div class="page" id="requisition"><div class="topbar"><div class="topbar-left"><div class="topbar-title">Purchase Requests</div></div></div><div class="page-body" style="text-align:center;padding-top:80px;color:var(--text-muted);">Switch to <strong>OCR Document Scan</strong> to see the featured screen.</div></div>
<div class="page" id="bidding"><div class="topbar"><div class="topbar-left"><div class="topbar-title">Bidding & Tenders</div></div></div><div class="page-body" style="text-align:center;padding-top:80px;color:var(--text-muted);">Switch to <strong>OCR Document Scan</strong> to see the featured screen.</div></div>
<div class="page" id="suppliers"><div class="topbar"><div class="topbar-left"><div class="topbar-title">Supplier Management</div></div></div><div class="page-body" style="text-align:center;padding-top:80px;color:var(--text-muted);">Switch to <strong>OCR Document Scan</strong> to see the featured screen.</div></div>

</main>

<script>
// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function goto(id, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if (el) el.classList.add('active');
  window.scrollTo(0, 0);
}

// ‚îÄ‚îÄ DOC TYPE ‚îÄ‚îÄ
let selectedDocType = 'invoice';
function selectDocType(btn, type) {
  selectedDocType = type;
  document.querySelectorAll('.doc-type-btn').forEach(b => {
    b.style.background = 'var(--surface)';
    b.style.color = 'var(--text-muted)';
    b.style.borderColor = 'var(--border)';
  });
  btn.style.background = 'var(--blue)';
  btn.style.color = '#fff';
  btn.style.borderColor = 'var(--blue)';
}

// ‚îÄ‚îÄ FILE HANDLING ‚îÄ‚îÄ
let uploadedFile = null;
let uploadedBase64 = null;
let uploadedMimeType = null;

function handleDrop(event) {
  event.preventDefault();
  document.getElementById('dropZone').classList.remove('dragover');
  const file = event.dataTransfer.files[0];
  if (file) processFile(file);
}

function handleFileSelect(event) {
  const file = event.target.files[0];
  if (file) processFile(file);
}

function processFile(file) {
  uploadedFile = file;
  const dropZone = document.getElementById('dropZone');
  dropZone.classList.add('has-file');
  document.getElementById('dropIcon').innerHTML = `<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>`;
  document.getElementById('dropIcon').style.background = 'var(--green-bg)';
  document.getElementById('dropIcon').style.color = 'var(--green)';
  document.getElementById('dropTitle').textContent = file.name;
  document.getElementById('dropSub').textContent = `${(file.size/1024).toFixed(1)} KB ¬∑ Click to change`;

  const preview = document.getElementById('docPreview');
  preview.style.display = 'block';
  document.getElementById('previewFilename').textContent = file.name;
  document.getElementById('previewSize').textContent = `${(file.size/1024).toFixed(1)} KB`;

  const reader = new FileReader();
  reader.onload = (e) => {
    const dataUrl = e.target.result;
    uploadedBase64 = dataUrl.split(',')[1];
    uploadedMimeType = file.type || 'image/jpeg';

    if (file.type.startsWith('image/')) {
      document.getElementById('previewBody').innerHTML = `<img src="${dataUrl}" alt="Preview" />`;
    } else {
      document.getElementById('previewBody').innerHTML = `<div class="doc-preview-placeholder" style="color:#ccc;">üìÑ PDF document loaded<br><span style="font-size:11px;opacity:0.6">${file.name}</span></div>`;
    }
  };
  reader.readAsDataURL(file);

  document.getElementById('processBtn').disabled = false;
  addLog('info', `File loaded: ${file.name} (${(file.size/1024).toFixed(1)} KB)`);
  addLog('info', `Document type set to: ${selectedDocType === 'auto' ? 'Auto-detect' : selectedDocType}`);
  addLog('info', `Ready to process. Click "Process Document with AI OCR" to begin.`);
}

// ‚îÄ‚îÄ LOGGING ‚îÄ‚îÄ
function addLog(type, message) {
  const log = document.getElementById('ocrLog');
  const now = new Date();
  const time = now.toTimeString().slice(0,8);
  const div = document.createElement('div');
  div.className = 'log-line';
  div.innerHTML = `<span class="log-time">${time}</span><span class="log-${type}">${message}</span>`;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

// ‚îÄ‚îÄ OCR PROCESSING ‚îÄ‚îÄ
async function processOCR() {
  if (!uploadedBase64) return;

  document.getElementById('processBtn').disabled = true;
  document.getElementById('logStatus').style.display = 'inline-flex';
  document.getElementById('resultsSection').style.display = 'none';

  const docTypeLabel = selectedDocType === 'auto' ? 'procurement document' : selectedDocType.replace('_', ' ');

  addLog('info', `Initiating AI OCR processing‚Ä¶`);
  addLog('info', `Sending document to Claude vision API‚Ä¶`);
  addLog('info', `Extracting structured data from ${docTypeLabel}‚Ä¶`);

  const prompt = `You are an expert OCR system for a government procurement platform called GovProcure Enterprise.

Analyze this ${docTypeLabel} image and extract ALL visible information. Return ONLY a valid JSON object with this exact structure:

{
  "docType": "invoice|purchase_order|delivery_note|quotation|contract",
  "confidence": 0.95,
  "supplier": {
    "name": "",
    "vatNumber": "",
    "companyReg": "",
    "address": "",
    "phone": "",
    "email": "",
    "bankName": "",
    "accountNumber": "",
    "branchCode": ""
  },
  "document": {
    "number": "",
    "date": "",
    "dueDate": "",
    "poReference": "",
    "currency": "ZAR",
    "paymentTerms": ""
  },
  "buyer": {
    "name": "",
    "department": "",
    "address": ""
  },
  "lineItems": [
    {
      "description": "",
      "quantity": 0,
      "unit": "",
      "unitPrice": 0,
      "vatPercent": 15,
      "lineTotal": 0,
      "flagged": false,
      "flagReason": ""
    }
  ],
  "totals": {
    "subtotal": 0,
    "vatAmount": 0,
    "discount": 0,
    "grandTotal": 0
  },
  "validationFlags": [
    {"type": "pass|warn|fail", "message": ""}
  ],
  "rawText": "brief summary of what you can see in the document"
}

If this is not a real procurement document or is a test/generic image, still attempt extraction with whatever data is visible, or create plausible sample data for a South African government procurement context (ZAR currency, VAT at 15%). Set confidence appropriately.

Return ONLY the JSON. No markdown, no explanation.`;

  try {
    const isImage = uploadedMimeType.startsWith('image/');

    const messageContent = isImage ? [
      {
        type: "image",
        source: {
          type: "base64",
          media_type: uploadedMimeType,
          data: uploadedBase64
        }
      },
      { type: "text", text: prompt }
    ] : [
      {
        type: "document",
        source: {
          type: "base64",
          media_type: "application/pdf",
          data: uploadedBase64
        }
      },
      { type: "text", text: prompt }
    ];

    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        messages: [{ role: "user", content: messageContent }]
      })
    });

    const data = await response.json();
    const rawText = data.content.map(c => c.text || '').join('');
    addLog('success', `API response received.`);

    let cleaned = rawText.replace(/```json\n?/g,'').replace(/```\n?/g,'').trim();
    const extracted = JSON.parse(cleaned);

    addLog('success', `Data extraction complete. Confidence: ${Math.round((extracted.confidence || 0.9) * 100)}%`);
    addLog('info', `Found ${(extracted.lineItems || []).length} line item(s).`);
    if (extracted.validationFlags) {
      const fails = extracted.validationFlags.filter(f => f.type === 'fail').length;
      const warns = extracted.validationFlags.filter(f => f.type === 'warn').length;
      if (fails > 0) addLog('error', `${fails} validation failure(s) detected.`);
      if (warns > 0) addLog('warn', `${warns} validation warning(s) detected.`);
      if (fails === 0 && warns === 0) addLog('success', `All validation checks passed.`);
    }

    renderResults(extracted);

  } catch (err) {
    addLog('error', `Processing error: ${err.message}`);
    addLog('warn', `Displaying demo data for illustration purposes.`);
    renderResults(getDemoData());
  }

  document.getElementById('logStatus').style.display = 'none';
  document.getElementById('processBtn').disabled = false;
}

// ‚îÄ‚îÄ DEMO FALLBACK ‚îÄ‚îÄ
function getDemoData() {
  return {
    docType: "invoice",
    confidence: 0.96,
    supplier: {
      name: "Datacom Solutions (Pty) Ltd",
      vatNumber: "4620183751",
      companyReg: "2018/043721/07",
      address: "14 Electron Avenue, Technopark, Pretoria, 0157",
      phone: "+27 12 345 6789",
      email: "accounts@datacom.co.za",
      bankName: "First National Bank",
      accountNumber: "62843917024",
      branchCode: "251345"
    },
    document: {
      number: "INV-2026-00412",
      date: "2026-02-24",
      dueDate: "2026-03-26",
      poReference: "PO-2026-0412",
      currency: "ZAR",
      paymentTerms: "30 days net"
    },
    buyer: {
      name: "Department of Public Works",
      department: "ICT Directorate",
      address: "Private Bag X65, Pretoria, 0001"
    },
    lineItems: [
      { description: "Dell Latitude 5540 Laptop (i5-13th Gen, 16GB RAM, 512GB SSD)", quantity: 15, unit: "EA", unitPrice: 18500, vatPercent: 15, lineTotal: 277500, flagged: false, flagReason: "" },
      { description: "Dell USB-C Dock WD19S 180W", quantity: 15, unit: "EA", unitPrice: 2400, vatPercent: 15, lineTotal: 36000, flagged: false, flagReason: "" },
      { description: "Logitech MX Master 3 Wireless Mouse", quantity: 20, unit: "EA", unitPrice: 850, vatPercent: 15, lineTotal: 17000, flagged: true, flagReason: "Qty exceeds PO by 5 units" },
      { description: "On-site delivery & configuration (8hrs @ R450/hr)", quantity: 8, unit: "HR", unitPrice: 450, vatPercent: 15, lineTotal: 3600, flagged: false, flagReason: "" }
    ],
    totals: { subtotal: 334100, vatAmount: 50115, discount: 0, grandTotal: 384215 },
    validationFlags: [
      { type: "pass", message: "Supplier VAT number verified against SARS database" },
      { type: "pass", message: "Invoice number matches PO reference PO-2026-0412" },
      { type: "warn", message: "Line item 3 quantity (20) exceeds approved PO quantity (15) by 5 units" },
      { type: "pass", message: "VAT calculation verified at 15%" },
      { type: "pass", message: "Banking details match registered supplier profile" }
    ]
  };
}

// ‚îÄ‚îÄ RENDER RESULTS ‚îÄ‚îÄ
function renderResults(data) {
  const conf = Math.round((data.confidence || 0.9) * 100);
  document.getElementById('confBar').style.width = conf + '%';
  document.getElementById('confPct').textContent = conf + '%';
  document.getElementById('confBar').style.background = conf >= 90 ? 'var(--green)' : conf >= 70 ? 'var(--orange)' : 'var(--red)';
  document.getElementById('confPct').style.color = conf >= 90 ? 'var(--green)' : conf >= 70 ? 'var(--orange)' : 'var(--red)';

  const typeMap = { invoice: 'Invoice', purchase_order: 'Purchase Order', delivery_note: 'Delivery Note', quotation: 'Quotation', contract: 'Contract' };
  document.getElementById('resultDocType').textContent = typeMap[data.docType] || data.docType || 'Document';

  // Header fields
  const fields = [
    { label: 'Document Number', value: data.document?.number || '', conf: 'high' },
    { label: 'Document Date', value: data.document?.date || '', conf: 'high' },
    { label: 'Due / Delivery Date', value: data.document?.dueDate || '', conf: 'high' },
    { label: 'PO Reference', value: data.document?.poReference || '', conf: 'high' },
    { label: 'Payment Terms', value: data.document?.paymentTerms || '', conf: 'med' },
    { label: 'Supplier Name', value: data.supplier?.name || '', conf: 'high' },
    { label: 'Supplier VAT No.', value: data.supplier?.vatNumber || '', conf: 'high' },
    { label: 'Company Reg. No.', value: data.supplier?.companyReg || '', conf: 'med' },
    { label: 'Supplier Address', value: data.supplier?.address || '', conf: 'high' },
    { label: 'Supplier Email', value: data.supplier?.email || '', conf: 'med' },
    { label: 'Bank Account No.', value: data.supplier?.accountNumber || '', conf: data.supplier?.accountNumber ? 'high' : 'low' },
    { label: 'Branch Code', value: data.supplier?.branchCode || '', conf: data.supplier?.branchCode ? 'high' : 'low' },
    { label: 'Buyer / Department', value: `${data.buyer?.name || ''} ‚Äî ${data.buyer?.department || ''}`, conf: 'med' },
  ];

  const confMap = { high: { label: '98%', cls: 'conf-high' }, med: { label: '82%', cls: 'conf-med' }, low: { label: '61%', cls: 'conf-low' } };

  const fieldsHtml = fields.map(f => `
    <div class="field-row">
      <div class="field-label">${f.label}</div>
      <div class="field-input-wrap">
        <input type="text" value="${escHtml(f.value)}" placeholder="Not detected" />
        <span class="field-confidence ${confMap[f.conf].cls}">${confMap[f.conf].label}</span>
      </div>
    </div>
  `).join('');
  document.getElementById('extractedFields').innerHTML = fieldsHtml;

  // Line items
  if (data.lineItems && data.lineItems.length > 0) {
    document.getElementById('lineItemsSection').style.display = 'block';
    const rows = data.lineItems.map((item, i) => `
      <tr class="${item.flagged ? 'flagged' : ''}">
        <td style="color:var(--text-muted);font-size:11px;">${i+1}</td>
        <td><input type="text" value="${escHtml(item.description)}" style="min-width:200px;" /></td>
        <td><input type="text" value="${item.quantity}" style="width:50px;" /></td>
        <td><input type="text" value="${item.unit}" style="width:45px;" /></td>
        <td><input type="text" value="${fmtNum(item.unitPrice)}" style="width:90px;" /></td>
        <td><input type="text" value="${item.vatPercent}%" style="width:45px;" /></td>
        <td style="font-weight:600;font-family:'IBM Plex Mono',monospace;font-size:12px;">R ${fmtNum(item.lineTotal)}</td>
        <td>${item.flagged ? `<span style="font-size:10.5px;color:var(--red);font-weight:600;" title="${escHtml(item.flagReason)}">‚ö† Flag</span>` : '<span style="font-size:11px;color:var(--green);">‚úì</span>'}</td>
      </tr>
    `).join('');

    const t = data.totals || {};
    const foot = `
      <tr class="totals-row"><td colspan="6" style="text-align:right;font-size:11.5px;color:var(--text-muted);">Subtotal</td><td class="mono">R ${fmtNum(t.subtotal)}</td><td></td></tr>
      ${t.discount ? `<tr class="totals-row"><td colspan="6" style="text-align:right;font-size:11.5px;color:var(--green);">Discount</td><td class="mono" style="color:var(--green);">- R ${fmtNum(t.discount)}</td><td></td></tr>` : ''}
      <tr class="totals-row"><td colspan="6" style="text-align:right;font-size:11.5px;color:var(--text-muted);">VAT (15%)</td><td class="mono">R ${fmtNum(t.vatAmount)}</td><td></td></tr>
      <tr style="background:var(--navy);"><td colspan="6" style="text-align:right;font-size:13px;font-weight:700;color:#fff;padding:10px 10px;">TOTAL AMOUNT DUE</td><td style="font-family:'IBM Plex Mono',monospace;font-size:14px;font-weight:700;color:var(--accent);padding:10px;">R ${fmtNum(t.grandTotal)}</td><td style="background:var(--navy);"></td></tr>
    `;
    document.getElementById('lineItemsBody').innerHTML = rows;
    document.getElementById('lineItemsFoot').innerHTML = foot;
  }

  // Validation
  if (data.validationFlags && data.validationFlags.length > 0) {
    document.getElementById('validationPanel').style.display = 'block';
    const icons = {
      pass: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>`,
      warn: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
      fail: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`
    };
    document.getElementById('validationList').innerHTML = data.validationFlags.map(f =>
      `<div class="validation-item ${f.type}">${icons[f.type] || icons.warn}<span>${escHtml(f.message)}</span></div>`
    ).join('');
  }

  // Mini preview image
  const previewImg = document.getElementById('previewBody').innerHTML;
  document.getElementById('miniPreviewImg').innerHTML = previewImg;

  document.getElementById('resultsSection').style.display = 'block';
  document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function fmtNum(n) {
  if (!n && n !== 0) return '‚Äî';
  return Number(n).toLocaleString('en-ZA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function escHtml(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function saveToSystem() {
  addLog('success', 'Document data saved to procurement system successfully.');
  addLog('info', 'Invoice matched to PO-2026-0412. Awaiting 3-way match with GRN.');
  document.getElementById('resultStatus').textContent = 'Saved';
  document.getElementById('resultStatus').className = 'status status-approved';
  alert('‚úÖ Document saved to GovProcure system.\n\nA 3-way match (PO ‚Üî Invoice ‚Üî GRN) will be triggered automatically once the Goods Receipt Note is received.');
}

function resetOcr() {
  uploadedFile = null;
  uploadedBase64 = null;
  document.getElementById('dropZone').classList.remove('has-file','dragover');
  document.getElementById('dropIcon').innerHTML = `<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>`;
  document.getElementById('dropIcon').style.background = 'var(--blue-bg)';
  document.getElementById('dropIcon').style.color = 'var(--blue)';
  document.getElementById('dropTitle').textContent = 'Drag & drop your document here';
  document.getElementById('dropSub').textContent = 'Or click to browse your files. Scanned PDFs, photos of documents, and image files are all supported.';
  document.getElementById('docPreview').style.display = 'none';
  document.getElementById('processBtn').disabled = true;
  document.getElementById('resultsSection').style.display = 'none';
  document.getElementById('validationPanel').style.display = 'none';
  document.getElementById('lineItemsSection').style.display = 'none';
  document.getElementById('fileInput').value = '';
  document.getElementById('ocrLog').innerHTML = '<div class="log-line"><span class="log-time">--:--:--</span><span class="log-info">System ready. Awaiting document upload‚Ä¶</span></div>';
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
document.getElementById('processBtn').style.display = 'flex';
document.getElementById('processRow') && (document.getElementById('processRow').style.display = 'flex');

// Activate OCR nav item on load
document.querySelectorAll('.nav-item')[1].classList.add('active');
</script>
</body>
</html>
