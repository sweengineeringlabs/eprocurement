<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - SARS eProcurement</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=IBM+Plex+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body style="margin-left: 0; background: var(--bg);">
  <div class="content page-enter">
    <div class="page-header">
      <div class="page-header-left">
        <h1>Procurement Dashboard</h1>
        <p>Overview of procurement activities for FY 2025/26</p>
      </div>
      <div class="page-header-actions">
        <button class="btn btn-secondary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Export Report
        </button>
        <a href="requisitions/create.html" class="btn btn-primary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          New Requisition
        </a>
      </div>
    </div>

    <!-- KPI Cards Row 1 -->
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon blue">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          </div>
        </div>
        <div class="kpi-label">Active Requisitions</div>
        <div class="kpi-value">127</div>
        <div class="kpi-delta"><span class="up">↑ 12%</span> from last month</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-header">
          <div class="kpi-icon green">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          </div>
        </div>
        <div class="kpi-label">Open Tenders</div>
        <div class="kpi-value">23</div>
        <div class="kpi-delta"><span class="up">↑ 8%</span> from last month</div>
      </div>
      <div class="kpi-card accent">
        <div class="kpi-header">
          <div class="kpi-icon accent">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>
          </div>
        </div>
        <div class="kpi-label">YTD Spend</div>
        <div class="kpi-value">R 847M</div>
        <div class="kpi-delta"><span class="down">↓ 3%</span> vs budget</div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-header">
          <div class="kpi-icon purple">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          </div>
        </div>
        <div class="kpi-label">Active Suppliers</div>
        <div class="kpi-value">1,284</div>
        <div class="kpi-delta"><span class="up">↑ 45</span> new this month</div>
      </div>
    </div>

    <!-- KPI Cards Row 2 -->
    <div class="kpi-grid mb-24">
      <div class="kpi-card orange">
        <div class="kpi-header">
          <div class="kpi-icon orange">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          </div>
        </div>
        <div class="kpi-label">Pending Approvals</div>
        <div class="kpi-value">34</div>
        <div class="kpi-delta">8 urgent (>5 days)</div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-header">
          <div class="kpi-icon cyan">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M12 18v-6"/><path d="M9 15h6"/></svg>
          </div>
        </div>
        <div class="kpi-label">Active Contracts</div>
        <div class="kpi-value">456</div>
        <div class="kpi-delta">12 expiring in 30 days</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-header">
          <div class="kpi-icon green">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
          </div>
        </div>
        <div class="kpi-label">B-BBEE Spend</div>
        <div class="kpi-value">78.4%</div>
        <div class="kpi-delta">Target: 80%</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-header">
          <div class="kpi-icon red">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
          </div>
        </div>
        <div class="kpi-label">Compliance Issues</div>
        <div class="kpi-value">7</div>
        <div class="kpi-delta">3 critical attention needed</div>
      </div>
    </div>

    <div class="grid-3-2">
      <!-- Recent Requisitions -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Recent Requisitions</span>
          <a href="requisitions/list.html" class="btn btn-sm btn-secondary">View All</a>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Req ID</th>
              <th>Description</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="id-cell">REQ-2025-0847</td>
              <td>IT Hardware - Laptops Q4</td>
              <td class="amount-cell">R 2,450,000</td>
              <td><span class="status status-pending">Pending Approval</span></td>
            </tr>
            <tr>
              <td class="id-cell">REQ-2025-0846</td>
              <td>Office Supplies - Stationery</td>
              <td class="amount-cell">R 125,000</td>
              <td><span class="status status-approved">Approved</span></td>
            </tr>
            <tr>
              <td class="id-cell">REQ-2025-0845</td>
              <td>Security Services - Annual</td>
              <td class="amount-cell">R 8,750,000</td>
              <td><span class="status status-evaluation">In Evaluation</span></td>
            </tr>
            <tr>
              <td class="id-cell">REQ-2025-0844</td>
              <td>Fleet Maintenance Services</td>
              <td class="amount-cell">R 1,200,000</td>
              <td><span class="status status-approved">Approved</span></td>
            </tr>
            <tr>
              <td class="id-cell">REQ-2025-0843</td>
              <td>Training - Staff Development</td>
              <td class="amount-cell">R 560,000</td>
              <td><span class="status status-draft">Draft</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Activity Timeline -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Recent Activity</span>
        </div>
        <div class="panel-body">
          <div class="timeline">
            <div class="timeline-item completed">
              <div class="timeline-date">Today, 14:32</div>
              <div class="timeline-title">Tender RFP-2025-0089 Published</div>
              <div class="timeline-desc">IT Infrastructure Upgrade - Open for bidding</div>
            </div>
            <div class="timeline-item completed">
              <div class="timeline-date">Today, 11:15</div>
              <div class="timeline-title">Contract CTR-2025-0234 Signed</div>
              <div class="timeline-desc">Awarded to TechSolutions SA (Pty) Ltd</div>
            </div>
            <div class="timeline-item pending">
              <div class="timeline-date">Today, 09:45</div>
              <div class="timeline-title">Requisition REQ-2025-0847 Submitted</div>
              <div class="timeline-desc">Awaiting budget holder approval</div>
            </div>
            <div class="timeline-item completed">
              <div class="timeline-date">Yesterday, 16:20</div>
              <div class="timeline-title">NBAC Meeting Completed</div>
              <div class="timeline-desc">3 bids adjudicated and approved</div>
            </div>
            <div class="timeline-item completed">
              <div class="timeline-date">Yesterday, 10:00</div>
              <div class="timeline-title">Supplier Onboarded</div>
              <div class="timeline-desc">GreenTech Solutions - B-BBEE Level 1</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid-2">
      <!-- Spend by Category -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Spend by Category</span>
          <select style="padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px;">
            <option>This Month</option>
            <option>This Quarter</option>
            <option>This Year</option>
          </select>
        </div>
        <div class="panel-body">
          <div class="chart-placeholder">
            <div class="chart-bar" style="height: 85%;"></div>
            <div class="chart-bar" style="height: 65%;"></div>
            <div class="chart-bar" style="height: 92%;"></div>
            <div class="chart-bar" style="height: 45%;"></div>
            <div class="chart-bar" style="height: 78%;"></div>
            <div class="chart-bar" style="height: 55%;"></div>
          </div>
          <div style="display: flex; justify-content: space-around; margin-top: 12px; font-size: 11px; color: var(--text-muted);">
            <span>IT</span>
            <span>Facilities</span>
            <span>Prof. Svcs</span>
            <span>Security</span>
            <span>Fleet</span>
            <span>Other</span>
          </div>
        </div>
      </div>

      <!-- B-BBEE Performance -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">B-BBEE Performance</span>
        </div>
        <div class="panel-body">
          <div style="display: flex; justify-content: space-around; text-align: center;">
            <div>
              <div style="width: 80px; height: 80px; border-radius: 50%; border: 6px solid var(--green); display: flex; align-items: center; justify-content: center; margin: 0 auto 8px;">
                <span style="font-size: 20px; font-weight: 600;">42%</span>
              </div>
              <div style="font-size: 12px; color: var(--text-muted);">Level 1</div>
            </div>
            <div>
              <div style="width: 80px; height: 80px; border-radius: 50%; border: 6px solid var(--blue); display: flex; align-items: center; justify-content: center; margin: 0 auto 8px;">
                <span style="font-size: 20px; font-weight: 600;">28%</span>
              </div>
              <div style="font-size: 12px; color: var(--text-muted);">Level 2</div>
            </div>
            <div>
              <div style="width: 80px; height: 80px; border-radius: 50%; border: 6px solid var(--orange); display: flex; align-items: center; justify-content: center; margin: 0 auto 8px;">
                <span style="font-size: 20px; font-weight: 600;">18%</span>
              </div>
              <div style="font-size: 12px; color: var(--text-muted);">Level 3-4</div>
            </div>
            <div>
              <div style="width: 80px; height: 80px; border-radius: 50%; border: 6px solid var(--text-muted); display: flex; align-items: center; justify-content: center; margin: 0 auto 8px;">
                <span style="font-size: 20px; font-weight: 600;">12%</span>
              </div>
              <div style="font-size: 12px; color: var(--text-muted);">Other</div>
            </div>
          </div>
          <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-size: 12px;">Overall B-BBEE Target Progress</span>
              <span style="font-size: 12px; font-weight: 600;">78.4% / 80%</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill green" style="width: 78.4%;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/app.js"></script>
  <script>
    // Dashboard-specific actions
    document.querySelectorAll('.data-table tbody tr').forEach(row => {
      row.addEventListener('click', function() {
        const id = this.querySelector('.id-cell')?.textContent;
        if (id) ProcurementActions.viewDetails('Requisition', id);
      });
    });

    // KPI card clicks
    document.querySelectorAll('.kpi-card').forEach(card => {
      card.style.cursor = 'pointer';
      card.addEventListener('click', function() {
        const label = this.querySelector('.kpi-label')?.textContent;
        Toast.show(`Viewing ${label} details...`, 'info');
      });
    });

    // Timeline item clicks
    document.querySelectorAll('.timeline-item').forEach(item => {
      item.style.cursor = 'pointer';
      item.addEventListener('click', function() {
        const title = this.querySelector('.timeline-title')?.textContent;
        Toast.show(`Viewing: ${title}`, 'info');
      });
    });

    // Export button
    document.querySelector('.btn-secondary').addEventListener('click', function(e) {
      e.preventDefault();
      ReportActions.export('Dashboard Summary', 'PDF');
    });
  </script>
</body>
</html>
