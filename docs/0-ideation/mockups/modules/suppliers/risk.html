<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supplier Risk Assessment - SARS eProcurement</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=IBM+Plex+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/styles.css">
</head>
<body style="margin-left: 0; background: var(--bg);">
  <div class="content page-enter">
    <div class="page-header">
      <div class="page-header-left">
        <h1>Supplier Risk Assessment</h1>
        <p>BRS 4.3 & 4.15 - Risk scoring and AI-driven risk identification</p>
      </div>
      <div class="page-header-actions">
        <button class="btn btn-secondary" id="exportBtn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Export Risk Report
        </button>
        <button class="btn btn-primary" id="assessBtn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          Run Risk Assessment
        </button>
      </div>
    </div>

    <!-- Risk Overview KPIs -->
    <div class="kpi-grid mb-24">
      <div class="kpi-card" style="border-left: 4px solid #dc2626;">
        <div class="kpi-label">High Risk</div>
        <div class="kpi-value" style="color: #dc2626;">8</div>
        <div class="kpi-delta">Require immediate action</div>
      </div>
      <div class="kpi-card orange">
        <div class="kpi-label">Medium Risk</div>
        <div class="kpi-value">23</div>
        <div class="kpi-delta">Monitor closely</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Low Risk</div>
        <div class="kpi-value">125</div>
        <div class="kpi-delta">Standard monitoring</div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-label">Financial Health Alerts</div>
        <div class="kpi-value">5</div>
        <div class="kpi-delta">BRS 4.15 AI scoring</div>
      </div>
    </div>

    <div class="grid-2 mb-24">
      <!-- Risk Distribution -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Risk Distribution by Category</span>
        </div>
        <div class="panel-body">
          <div style="display: flex; justify-content: center; margin-bottom: 24px;">
            <div style="width: 180px; height: 180px; border-radius: 50%; background: conic-gradient(
              #dc2626 0% 5%,
              #f97316 5% 20%,
              #22c55e 20% 100%
            ); display: flex; align-items: center; justify-content: center;">
              <div style="width: 100px; height: 100px; background: white; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div style="font-size: 24px; font-weight: 700;">156</div>
                <div style="font-size: 10px; color: var(--text-muted);">Suppliers</div>
              </div>
            </div>
          </div>
          <div style="display: flex; justify-content: center; gap: 24px; font-size: 12px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 12px; height: 12px; background: #dc2626; border-radius: 2px;"></div>
              <span>High (5%)</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 12px; height: 12px; background: #f97316; border-radius: 2px;"></div>
              <span>Medium (15%)</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 12px; height: 12px; background: #22c55e; border-radius: 2px;"></div>
              <span>Low (80%)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Risk Factors -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">AI Risk Factor Analysis (BRS 4.15)</span>
        </div>
        <div class="panel-body">
          <div style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
              <span style="font-weight: 500;">Financial Health</span>
              <span style="font-weight: 600;">15 alerts</span>
            </div>
            <div class="progress-track"><div class="progress-fill orange" style="width: 30%;"></div></div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
              <span style="font-weight: 500;">Compliance Gaps</span>
              <span style="font-weight: 600;">8 alerts</span>
            </div>
            <div class="progress-track"><div class="progress-fill" style="width: 15%; background: #dc2626;"></div></div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
              <span style="font-weight: 500;">Performance History</span>
              <span style="font-weight: 600;">12 alerts</span>
            </div>
            <div class="progress-track"><div class="progress-fill orange" style="width: 25%;"></div></div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
              <span style="font-weight: 500;">Contract Dependencies</span>
              <span style="font-weight: 600;">6 alerts</span>
            </div>
            <div class="progress-track"><div class="progress-fill purple" style="width: 12%;"></div></div>
          </div>
          <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
              <span style="font-weight: 500;">Market/Industry Risk</span>
              <span style="font-weight: 600;">4 alerts</span>
            </div>
            <div class="progress-track"><div class="progress-fill green" style="width: 8%;"></div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- High Risk Suppliers -->
    <div class="panel mb-24" style="border-left: 4px solid #dc2626;">
      <div class="panel-header">
        <span class="panel-title" style="color: #dc2626;">High Risk Suppliers - Immediate Action Required</span>
      </div>
      <table class="data-table">
        <thead>
          <tr>
            <th>Supplier</th>
            <th>Risk Score</th>
            <th>Risk Factors</th>
            <th>Contract Value</th>
            <th>Expiry</th>
            <th>AI Recommendation</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr style="background: #fef2f2;">
            <td>
              <div style="font-weight: 500;">DataCore Systems</div>
              <div style="font-size: 11px; color: var(--text-muted);">MAAA0067890</div>
            </td>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 40px; height: 40px; background: #dc2626; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">92</div>
                <span style="color: #dc2626; font-weight: 600;">Critical</span>
              </div>
            </td>
            <td>
              <span class="tag" style="background: #fef2f2; color: #dc2626; margin-right: 4px;">Financial Distress</span>
              <span class="tag" style="background: #fef2f2; color: #dc2626;">Late Payments</span>
            </td>
            <td style="font-family: 'IBM Plex Mono'; font-weight: 600;">R 12,500,000</td>
            <td>Jun 2025</td>
            <td style="font-size: 12px;">Initiate contingency plan; identify alternative suppliers</td>
            <td>
              <button class="btn btn-sm btn-accent">Mitigate</button>
            </td>
          </tr>
          <tr style="background: #fef2f2;">
            <td>
              <div style="font-weight: 500;">SecureGuard Services</div>
              <div style="font-size: 11px; color: var(--text-muted);">MAAA0056789</div>
            </td>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 40px; height: 40px; background: #dc2626; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">85</div>
                <span style="color: #dc2626; font-weight: 600;">High</span>
              </div>
            </td>
            <td>
              <span class="tag" style="background: #fef2f2; color: #dc2626; margin-right: 4px;">Performance</span>
              <span class="tag" style="background: #fef9c3; color: #ca8a04;">Compliance</span>
            </td>
            <td style="font-family: 'IBM Plex Mono'; font-weight: 600;">R 45,000,000</td>
            <td>Dec 2025</td>
            <td style="font-size: 12px;">Issue performance improvement notice; increase monitoring</td>
            <td>
              <button class="btn btn-sm btn-accent">Mitigate</button>
            </td>
          </tr>
          <tr style="background: #fef2f2;">
            <td>
              <div style="font-weight: 500;">FleetServe Motors</div>
              <div style="font-size: 11px; color: var(--text-muted);">MAAA0078901</div>
            </td>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 40px; height: 40px; background: #dc2626; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">81</div>
                <span style="color: #dc2626; font-weight: 600;">High</span>
              </div>
            </td>
            <td>
              <span class="tag" style="background: #fef9c3; color: #ca8a04; margin-right: 4px;">B-BBEE Expired</span>
              <span class="tag" style="background: #fef9c3; color: #ca8a04;">Tax Status</span>
            </td>
            <td style="font-family: 'IBM Plex Mono'; font-weight: 600;">R 8,200,000</td>
            <td>Mar 2025</td>
            <td style="font-size: 12px;">Suspend orders until compliance restored</td>
            <td>
              <button class="btn btn-sm btn-accent">Mitigate</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Risk Scoring Model -->
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Risk Scoring Model (BRS 4.3)</span>
      </div>
      <div class="panel-body">
        <div class="grid-2">
          <div>
            <div style="font-weight: 600; margin-bottom: 16px; color: var(--navy);">Risk Assessment Criteria</div>
            <table class="data-table">
              <thead>
                <tr>
                  <th>Factor</th>
                  <th style="width: 80px;">Weight</th>
                  <th style="width: 200px;">Data Sources</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Financial Health Score</td>
                  <td>25%</td>
                  <td style="font-size: 11px;">Credit bureaus, financial statements</td>
                </tr>
                <tr>
                  <td>Compliance Status</td>
                  <td>20%</td>
                  <td style="font-size: 11px;">CSD, SARS, B-BBEE verification</td>
                </tr>
                <tr>
                  <td>Performance History</td>
                  <td>20%</td>
                  <td style="font-size: 11px;">Internal evaluations, delivery records</td>
                </tr>
                <tr>
                  <td>Dependency Level</td>
                  <td>15%</td>
                  <td style="font-size: 11px;">Contract value, alternatives available</td>
                </tr>
                <tr>
                  <td>Market Stability</td>
                  <td>10%</td>
                  <td style="font-size: 11px;">Industry reports, news monitoring</td>
                </tr>
                <tr>
                  <td>Operational Capacity</td>
                  <td>10%</td>
                  <td style="font-size: 11px;">Site audits, resource assessments</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div>
            <div style="font-weight: 600; margin-bottom: 16px; color: var(--navy);">Risk Thresholds</div>
            <div style="padding: 16px; background: #fef2f2; border-radius: var(--radius); margin-bottom: 12px; border-left: 4px solid #dc2626;">
              <div style="font-weight: 600; color: #dc2626; margin-bottom: 4px;">High Risk: Score 75-100</div>
              <div style="font-size: 12px; color: var(--text-muted);">Immediate mitigation required. Consider contract termination or intensive monitoring.</div>
            </div>
            <div style="padding: 16px; background: #fef9c3; border-radius: var(--radius); margin-bottom: 12px; border-left: 4px solid #f97316;">
              <div style="font-weight: 600; color: #ca8a04; margin-bottom: 4px;">Medium Risk: Score 40-74</div>
              <div style="font-size: 12px; color: var(--text-muted);">Enhanced monitoring. Develop contingency plans and improvement targets.</div>
            </div>
            <div style="padding: 16px; background: #dcfce7; border-radius: var(--radius); border-left: 4px solid var(--green);">
              <div style="font-weight: 600; color: var(--green); margin-bottom: 4px;">Low Risk: Score 0-39</div>
              <div style="font-size: 12px; color: var(--text-muted);">Standard monitoring. Annual reassessment cycle.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../../js/app.js"></script>
  <script>
    // Export button
    document.getElementById('exportBtn').addEventListener('click', function() {
      ReportActions.export('Supplier Risk Assessment', 'PDF');
    });

    // Run Risk Assessment button
    document.getElementById('assessBtn').addEventListener('click', function() {
      Modal.show({
        title: 'Run Risk Assessment',
        content: `
          <div class="form-grid">
            <div class="form-group span-2">
              <label class="form-label">Assessment Scope</label>
              <select class="form-input">
                <option>All Active Suppliers</option>
                <option>High Value Contracts Only (>R10M)</option>
                <option>Expiring Contracts (Next 6 Months)</option>
                <option>Specific Category</option>
              </select>
            </div>
            <div class="form-group span-2">
              <label class="form-label">Include AI Financial Health Check</label>
              <div style="display: flex; gap: 16px; margin-top: 8px;">
                <label style="display: flex; align-items: center; gap: 8px;">
                  <input type="radio" name="ai" checked> Yes (Recommended)
                </label>
                <label style="display: flex; align-items: center; gap: 8px;">
                  <input type="radio" name="ai"> No
                </label>
              </div>
            </div>
          </div>
        `,
        actions: [
          { label: 'Cancel', type: 'secondary', action: Modal.close },
          { label: 'Run Assessment', type: 'primary', action: () => { Loading.show(); setTimeout(() => { Loading.hide(); Toast.show('Risk assessment initiated for 156 suppliers', 'success'); Modal.close(); }, 1500); }}
        ]
      });
    });

    // KPI cards
    document.querySelectorAll('.kpi-card').forEach(card => {
      card.style.cursor = 'pointer';
      card.addEventListener('click', function() {
        const label = this.querySelector('.kpi-label')?.textContent;
        Toast.show(`Filtering by: ${label}`, 'info');
      });
    });

    // Mitigate buttons
    document.querySelectorAll('.btn-accent').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        const row = this.closest('tr');
        const supplier = row?.querySelector('div[style*="font-weight: 500"]')?.textContent;

        Modal.show({
          title: `Mitigate Risk: ${supplier}`,
          content: `
            <div class="form-group">
              <label class="form-label">Mitigation Action</label>
              <select class="form-input">
                <option>Issue Performance Notice</option>
                <option>Increase Monitoring Frequency</option>
                <option>Request Financial Statement</option>
                <option>Suspend New Orders</option>
                <option>Initiate Contract Review</option>
                <option>Identify Alternative Suppliers</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Notes</label>
              <textarea class="form-input" rows="3" placeholder="Add notes for the mitigation action..."></textarea>
            </div>
          `,
          actions: [
            { label: 'Cancel', type: 'secondary', action: Modal.close },
            { label: 'Create Action', type: 'primary', action: () => { Loading.show(); setTimeout(() => { Loading.hide(); Toast.show('Mitigation action created', 'success'); Modal.close(); }, 800); }}
          ]
        });
      });
    });

    // Table rows
    document.querySelectorAll('.data-table tbody tr').forEach(row => {
      row.style.cursor = 'pointer';
      row.addEventListener('click', function(e) {
        if (e.target.closest('button')) return;
        const supplier = this.querySelector('div[style*="font-weight: 500"]')?.textContent;
        if (supplier) Toast.show(`Viewing risk details: ${supplier}`, 'info');
      });
    });
  </script>
</body>
</html>
