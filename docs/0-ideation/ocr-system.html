<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DOCUSCAN ‚Äî Intelligent OCR Processing Engine</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Geist+Mono:wght@300;400;500;600&family=Geist:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DESIGN SYSTEM ‚Äî DARK INDUSTRIAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root {
  --ink:       #080b10;
  --deep:      #0d1117;
  --surface:   #111620;
  --raised:    #161c28;
  --card:      #1a2235;
  --border:    #232d42;
  --border2:   #2d3a52;
  --glow:      #1e3a6e;

  --ice:       #e8f0fe;
  --steel:     #8fa3c8;
  --ghost:     #4d607d;

  --amber:     #f0a500;
  --amber-dim: rgba(240,165,0,0.12);
  --amber-glow:rgba(240,165,0,0.25);

  --cyan:      #00c8ff;
  --cyan-dim:  rgba(0,200,255,0.1);
  --cyan-glow: rgba(0,200,255,0.2);

  --emerald:   #00d68f;
  --em-dim:    rgba(0,214,143,0.1);

  --rose:      #ff4d6d;
  --rose-dim:  rgba(255,77,109,0.1);

  --gold:      #c8973a;

  --text:      #dde4f0;
  --muted:     #6b7fa0;
  --dim:       #3d4f6b;

  --shadow-card: 0 4px 24px rgba(0,0,0,0.4), 0 1px 4px rgba(0,0,0,0.3);
  --shadow-glow: 0 0 30px rgba(0,200,255,0.08);

  --r: 6px;
  --r-sm: 4px;
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--ink);
  color: var(--text);
  font-family: 'Geist', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Subtle grid texture */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(255,255,255,0.012) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.012) 1px, transparent 1px);
  background-size: 32px 32px;
  pointer-events: none;
  z-index: 0;
}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.app { display: flex; min-height: 100vh; position: relative; z-index: 1; }

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar {
  width: 64px;
  background: var(--deep);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px 0;
  position: fixed;
  left: 0; top: 0; bottom: 0;
  z-index: 100;
  gap: 6px;
}

.sidebar-logo {
  width: 38px; height: 38px;
  background: var(--amber);
  border-radius: var(--r-sm);
  display: flex; align-items: center; justify-content: center;
  font-family: 'DM Serif Display', serif;
  font-size: 18px;
  color: var(--ink);
  font-weight: 400;
  margin-bottom: 20px;
  flex-shrink: 0;
}

.sidebar-divider { width: 32px; height: 1px; background: var(--border); margin: 8px 0; }

.nav-btn {
  width: 40px; height: 40px;
  border-radius: var(--r-sm);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  color: var(--ghost);
  transition: all 0.15s;
  border: 1px solid transparent;
  position: relative;
}
.nav-btn:hover { background: var(--raised); color: var(--steel); border-color: var(--border); }
.nav-btn.active { background: var(--amber-dim); color: var(--amber); border-color: var(--amber-glow); }
.nav-btn svg { width: 17px; height: 17px; }

.nav-dot {
  position: absolute;
  top: 5px; right: 5px;
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--rose);
  border: 1.5px solid var(--deep);
}

.sidebar-bottom { margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 6px; }
.user-dot { width: 32px; height: 32px; border-radius: 50%; background: var(--glow); border: 2px solid var(--border2); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: var(--ice); font-family: 'Geist Mono', monospace; cursor: pointer; }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { margin-left: 64px; flex: 1; display: flex; flex-direction: column; }

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar {
  height: 56px;
  background: var(--deep);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 28px;
  gap: 20px;
  position: sticky;
  top: 0;
  z-index: 90;
}

.topbar-brand {
  display: flex;
  align-items: baseline;
  gap: 10px;
}
.topbar-name {
  font-family: 'DM Serif Display', serif;
  font-size: 17px;
  color: var(--ice);
  letter-spacing: 0.3px;
}
.topbar-version {
  font-family: 'Geist Mono', monospace;
  font-size: 10px;
  color: var(--ghost);
  letter-spacing: 0.5px;
  background: var(--raised);
  border: 1px solid var(--border);
  padding: 2px 7px;
  border-radius: 3px;
}

.topbar-breadcrumb {
  font-size: 12px;
  color: var(--ghost);
  font-family: 'Geist Mono', monospace;
  display: flex; align-items: center; gap: 6px;
}
.topbar-breadcrumb .sep { color: var(--dim); }
.topbar-breadcrumb .active { color: var(--amber); }

.topbar-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }

.tbar-btn {
  height: 32px; padding: 0 14px;
  border-radius: var(--r-sm);
  font-size: 12px; font-weight: 500;
  cursor: pointer; border: none;
  font-family: 'Geist', sans-serif;
  transition: all 0.15s;
  display: inline-flex; align-items: center; gap: 6px;
}
.tbar-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
.tbar-ghost:hover { background: var(--raised); color: var(--text); border-color: var(--border2); }
.tbar-amber { background: var(--amber); color: var(--ink); font-weight: 600; }
.tbar-amber:hover { background: #e09800; }

.status-pill {
  display: flex; align-items: center; gap: 6px;
  background: var(--raised); border: 1px solid var(--border);
  border-radius: 99px; padding: 4px 12px;
  font-size: 11px; font-family: 'Geist Mono', monospace;
  color: var(--muted);
}
.status-pill-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--emerald); animation: pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }

/* ‚îÄ‚îÄ CONTENT AREA ‚îÄ‚îÄ */
.content { flex: 1; padding: 28px; display: flex; flex-direction: column; gap: 20px; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PHASE 1 ‚Äî UPLOAD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#phase-upload { display: flex; flex-direction: column; gap: 20px; }
#phase-process { display: none; flex-direction: column; gap: 20px; }
#phase-results { display: none; flex-direction: column; gap: 20px; }

/* ‚îÄ‚îÄ DOC TYPE SELECTOR ‚îÄ‚îÄ */
.doc-type-row {
  display: flex; gap: 8px; flex-wrap: wrap;
}

.doc-type-chip {
  height: 34px; padding: 0 16px;
  border-radius: var(--r-sm);
  font-size: 12px; font-weight: 500;
  cursor: pointer;
  font-family: 'Geist', sans-serif;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--muted);
  transition: all 0.15s;
  display: flex; align-items: center; gap: 7px;
}
.doc-type-chip:hover { border-color: var(--border2); color: var(--steel); background: var(--raised); }
.doc-type-chip.active { border-color: var(--amber); background: var(--amber-dim); color: var(--amber); }
.doc-type-chip svg { width: 13px; height: 13px; }

/* ‚îÄ‚îÄ UPLOAD ZONE ‚îÄ‚îÄ */
.upload-grid { display: grid; grid-template-columns: 1fr 340px; gap: 20px; align-items: start; }

.drop-zone {
  background: var(--surface);
  border: 1.5px dashed var(--border2);
  border-radius: var(--r);
  min-height: 340px;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
  gap: 0;
}
.drop-zone:hover { border-color: var(--amber); background: rgba(240,165,0,0.03); }
.drop-zone.drag-over { border-color: var(--cyan); background: var(--cyan-dim); box-shadow: 0 0 0 3px var(--cyan-glow); }
.drop-zone.has-file { border-style: solid; border-color: var(--emerald); background: var(--surface); }

.drop-zone-inner { display: flex; flex-direction: column; align-items: center; gap: 16px; padding: 40px; text-align: center; }

.drop-icon-ring {
  width: 72px; height: 72px;
  border-radius: 50%;
  border: 1.5px solid var(--border2);
  display: flex; align-items: center; justify-content: center;
  color: var(--ghost);
  position: relative;
  transition: all 0.2s;
}
.drop-icon-ring::before {
  content: '';
  position: absolute; inset: -6px;
  border-radius: 50%;
  border: 1px dashed var(--border);
  animation: rotDash 20s linear infinite;
}
@keyframes rotDash { to { transform: rotate(360deg); } }
.drop-zone:hover .drop-icon-ring { border-color: var(--amber); color: var(--amber); }
.drop-zone.drag-over .drop-icon-ring { border-color: var(--cyan); color: var(--cyan); }

.drop-title {
  font-family: 'DM Serif Display', serif;
  font-size: 20px; color: var(--ice);
  line-height: 1.2;
}
.drop-sub { font-size: 13px; color: var(--muted); line-height: 1.6; max-width: 320px; }
.drop-or { font-size: 11px; color: var(--dim); font-family: 'Geist Mono', monospace; letter-spacing: 1px; }

.browse-btn {
  height: 36px; padding: 0 20px;
  background: var(--raised);
  border: 1px solid var(--border2);
  border-radius: var(--r-sm);
  color: var(--steel);
  font-size: 12.5px; font-weight: 500;
  cursor: pointer; font-family: 'Geist', sans-serif;
  transition: all 0.15s;
  display: flex; align-items: center; gap: 8px;
}
.browse-btn:hover { border-color: var(--amber); color: var(--amber); }

.format-tags { display: flex; gap: 6px; flex-wrap: wrap; justify-content: center; }
.fmt-tag {
  font-family: 'Geist Mono', monospace;
  font-size: 10px; font-weight: 500;
  padding: 3px 8px;
  border-radius: 3px;
  background: var(--raised);
  border: 1px solid var(--border);
  color: var(--dim);
  letter-spacing: 0.5px;
}

/* File preview inside drop zone */
.file-preview-img {
  width: 100%; height: 340px;
  object-fit: contain;
  background: #1a1a2e;
}
.file-preview-pdf {
  width: 100%; height: 340px;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 12px; color: var(--muted);
  background: var(--raised);
}
.file-info-bar {
  position: absolute; bottom: 0; left: 0; right: 0;
  background: rgba(8,11,16,0.9);
  backdrop-filter: blur(8px);
  border-top: 1px solid var(--border);
  padding: 10px 16px;
  display: flex; align-items: center; gap: 10px;
  font-size: 12px;
}
.file-info-name { font-family: 'Geist Mono', monospace; color: var(--emerald); font-size: 11.5px; }
.file-info-size { color: var(--muted); font-family: 'Geist Mono', monospace; font-size: 11px; margin-left: auto; }

/* ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ */
.right-panel { display: flex; flex-direction: column; gap: 16px; }

.info-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
}
.info-card-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 8px;
  font-size: 11px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1px;
  color: var(--muted);
}
.info-card-header svg { width: 13px; height: 13px; color: var(--amber); }
.info-card-body { padding: 14px 16px; }

.capability-row {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 8px 0; border-bottom: 1px solid var(--border);
  font-size: 12.5px;
}
.capability-row:last-child { border-bottom: none; }
.cap-icon { width: 28px; height: 28px; border-radius: var(--r-sm); display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 13px; }
.cap-title { font-weight: 500; color: var(--ice); margin-bottom: 2px; font-size: 12.5px; }
.cap-desc { font-size: 11px; color: var(--muted); line-height: 1.4; }

.process-btn {
  width: 100%;
  height: 46px;
  border-radius: var(--r);
  background: var(--amber);
  border: none;
  color: var(--ink);
  font-size: 13.5px; font-weight: 700;
  cursor: pointer;
  font-family: 'Geist', sans-serif;
  display: flex; align-items: center; justify-content: center; gap: 10px;
  transition: all 0.15s;
  letter-spacing: 0.3px;
  box-shadow: 0 4px 20px rgba(240,165,0,0.25);
}
.process-btn:hover { background: #e09800; box-shadow: 0 4px 28px rgba(240,165,0,0.4); transform: translateY(-1px); }
.process-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
.process-btn svg { width: 18px; height: 18px; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PHASE 2 ‚Äî PROCESSING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.processing-layout { display: grid; grid-template-columns: 1fr 400px; gap: 20px; align-items: start; }

/* Doc viewer with scan animation */
.doc-viewer {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  box-shadow: var(--shadow-card);
}
.doc-viewer-bar {
  background: var(--raised);
  border-bottom: 1px solid var(--border);
  padding: 10px 16px;
  display: flex; align-items: center; gap: 10px;
  font-size: 11.5px; color: var(--muted);
  font-family: 'Geist Mono', monospace;
}
.doc-viewer-controls { display: flex; gap: 6px; margin-right: 8px; }
.ctrl-dot { width: 10px; height: 10px; border-radius: 50%; }
.doc-viewer-body {
  position: relative;
  min-height: 400px;
  background: #1c1c2e;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
}
.doc-viewer-body img { max-width: 100%; max-height: 500px; object-fit: contain; }
.doc-viewer-placeholder { color: var(--ghost); font-size: 13px; font-family: 'Geist Mono', monospace; text-align: center; }

/* Scan beam */
.scan-beam {
  position: absolute;
  left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent 0%, var(--cyan) 20%, rgba(0,200,255,0.9) 50%, var(--cyan) 80%, transparent 100%);
  box-shadow: 0 0 20px 4px var(--cyan-glow), 0 0 40px 8px rgba(0,200,255,0.1);
  animation: scanBeam 2.2s ease-in-out infinite;
  display: none;
  z-index: 10;
}
@keyframes scanBeam {
  0% { top: 0%; opacity: 0; }
  5% { opacity: 1; }
  95% { opacity: 1; }
  100% { top: 100%; opacity: 0; }
}

/* Word highlight boxes (simulated) */
.word-boxes {
  position: absolute; inset: 0;
  pointer-events: none;
  display: none;
}
.word-box {
  position: absolute;
  border: 1px solid rgba(0,214,143,0.5);
  background: rgba(0,214,143,0.06);
  border-radius: 2px;
  animation: boxAppear 0.3s ease forwards;
  opacity: 0;
}
@keyframes boxAppear { to { opacity: 1; } }

/* Progress panel */
.progress-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  box-shadow: var(--shadow-card);
}

.progress-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}
.progress-title { font-family: 'DM Serif Display', serif; font-size: 16px; color: var(--ice); }
.progress-subtitle { font-size: 11px; color: var(--muted); margin-top: 2px; font-family: 'Geist Mono', monospace; }

/* Steps */
.steps-list { padding: 16px 20px; display: flex; flex-direction: column; gap: 4px; }
.step-item {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 12px;
  border-radius: var(--r-sm);
  transition: all 0.15s;
}
.step-item.current { background: var(--raised); border: 1px solid var(--border); }
.step-item.done { opacity: 0.7; }
.step-item.pending { opacity: 0.35; }

.step-badge {
  width: 28px; height: 28px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 700;
  font-family: 'Geist Mono', monospace;
  flex-shrink: 0;
}
.step-badge.done { background: var(--em-dim); color: var(--emerald); border: 1px solid rgba(0,214,143,0.3); }
.step-badge.current { background: var(--amber-dim); color: var(--amber); border: 1px solid var(--amber-glow); }
.step-badge.pending { background: var(--raised); color: var(--dim); border: 1px solid var(--border); }

.step-name { font-size: 12.5px; font-weight: 500; color: var(--ice); }
.step-desc { font-size: 11px; color: var(--muted); margin-top: 1px; }
.step-spinner { margin-left: auto; width: 16px; height: 16px; border: 2px solid var(--border2); border-top-color: var(--amber); border-radius: 50%; animation: spin 0.7s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Terminal log */
.terminal {
  background: var(--ink);
  border-top: 1px solid var(--border);
  padding: 14px 16px;
  font-family: 'Geist Mono', monospace;
  font-size: 11.5px;
  max-height: 160px;
  overflow-y: auto;
  display: flex; flex-direction: column; gap: 3px;
}
.t-line { display: flex; gap: 14px; line-height: 1.6; }
.t-time { color: var(--dim); flex-shrink: 0; }
.t-info { color: var(--steel); }
.t-ok { color: var(--emerald); }
.t-warn { color: var(--amber); }
.t-err { color: var(--rose); }
.t-data { color: var(--cyan); }
.t-cursor { display: inline-block; width: 7px; height: 13px; background: var(--amber); animation: blink 1s step-end infinite; vertical-align: text-bottom; }
@keyframes blink { 50% { opacity: 0; } }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PHASE 3 ‚Äî RESULTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.results-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.results-full { grid-column: span 2; }

/* Section headers */
.sec-header {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 16px;
}
.sec-title {
  font-family: 'DM Serif Display', serif;
  font-size: 15px; color: var(--ice);
}
.sec-line { flex: 1; height: 1px; background: var(--border); }
.sec-badge {
  font-family: 'Geist Mono', monospace;
  font-size: 10px; padding: 2px 8px;
  border-radius: 3px;
  background: var(--raised); border: 1px solid var(--border);
  color: var(--muted);
}

/* Extracted data card */
.data-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  box-shadow: var(--shadow-card);
}
.data-card-header {
  padding: 12px 18px;
  border-bottom: 1px solid var(--border);
  background: var(--raised);
  display: flex; align-items: center; justify-content: space-between;
}
.data-card-title {
  font-size: 11px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1px;
  color: var(--muted);
}
.data-card-body { padding: 4px 0; }

.field-row {
  display: flex; align-items: center;
  padding: 9px 18px;
  border-bottom: 1px solid rgba(35,45,66,0.5);
  gap: 12px;
}
.field-row:last-child { border-bottom: none; }
.field-row:hover { background: var(--raised); }
.field-key {
  font-family: 'Geist Mono', monospace;
  font-size: 10.5px; color: var(--ghost);
  width: 150px; flex-shrink: 0;
  letter-spacing: 0.3px;
}
.field-val-wrap { flex: 1; position: relative; }
.field-val-wrap input {
  width: 100%;
  background: transparent;
  border: 1px solid transparent;
  border-radius: 4px;
  padding: 5px 8px;
  font-size: 12.5px; font-family: 'Geist', sans-serif;
  color: var(--text);
  outline: none;
  transition: all 0.15s;
}
.field-val-wrap input:hover { border-color: var(--border); background: var(--raised); }
.field-val-wrap input:focus { border-color: var(--cyan); background: var(--raised); box-shadow: 0 0 0 3px var(--cyan-dim); }
.field-val-wrap input.flagged { border-color: rgba(255,77,109,0.4); background: var(--rose-dim); }
.field-conf {
  font-family: 'Geist Mono', monospace;
  font-size: 10px; font-weight: 600;
  padding: 2px 6px; border-radius: 3px;
  flex-shrink: 0;
}
.conf-hi { background: var(--em-dim); color: var(--emerald); border: 1px solid rgba(0,214,143,0.2); }
.conf-md { background: var(--amber-dim); color: var(--amber); border: 1px solid var(--amber-glow); }
.conf-lo { background: var(--rose-dim); color: var(--rose); border: 1px solid rgba(255,77,109,0.2); }

/* Confidence meter */
.conf-meter-wrap {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 20px;
  display: flex; flex-direction: column; gap: 14px;
}
.conf-overall {
  display: flex; align-items: center; gap: 16px;
}
.conf-ring {
  width: 72px; height: 72px;
  flex-shrink: 0;
  position: relative;
}
.conf-ring svg { transform: rotate(-90deg); }
.conf-ring-bg { fill: none; stroke: var(--raised); stroke-width: 6; }
.conf-ring-fill { fill: none; stroke-width: 6; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
.conf-ring-text {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  font-family: 'DM Serif Display', serif;
  font-size: 18px;
  color: var(--ice);
}
.conf-label { font-size: 13px; font-weight: 500; color: var(--ice); }
.conf-desc { font-size: 11.5px; color: var(--muted); margin-top: 3px; }

.conf-breakdown { display: flex; flex-direction: column; gap: 8px; }
.conf-item { display: flex; align-items: center; gap: 10px; font-size: 12px; }
.conf-item-label { color: var(--muted); width: 120px; }
.conf-item-bar { flex: 1; height: 4px; background: var(--border); border-radius: 99px; overflow: hidden; }
.conf-item-fill { height: 100%; border-radius: 99px; transition: width 1s ease 0.3s; }
.conf-item-pct { font-family: 'Geist Mono', monospace; font-size: 10.5px; color: var(--steel); width: 36px; text-align: right; }

/* Line items */
.line-table { width: 100%; border-collapse: collapse; }
.line-table thead th {
  padding: 9px 14px;
  text-align: left;
  font-size: 10px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.8px;
  color: var(--ghost);
  background: var(--raised);
  border-bottom: 1px solid var(--border);
  font-family: 'Geist Mono', monospace;
}
.line-table tbody td {
  padding: 8px 14px;
  font-size: 12.5px;
  border-bottom: 1px solid rgba(35,45,66,0.6);
  color: var(--steel);
  vertical-align: middle;
}
.line-table tbody tr:hover td { background: var(--raised); }
.line-table tbody tr.flag-row td { background: rgba(255,77,109,0.05); }
.line-table tfoot td {
  padding: 9px 14px;
  font-size: 12px;
  background: var(--raised);
  border-top: 1px solid var(--border2);
}
.line-table td input {
  background: transparent; border: none; outline: none;
  font-family: 'Geist', sans-serif; font-size: 12.5px;
  color: var(--text); width: 100%;
}
.line-table td input:focus { background: var(--glow); border-radius: 3px; padding: 2px 4px; }
.line-flag { font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 3px; background: var(--rose-dim); color: var(--rose); border: 1px solid rgba(255,77,109,0.3); }
.line-ok { font-size: 10px; color: var(--emerald); }

/* Validation */
.validation-stack { display: flex; flex-direction: column; gap: 6px; }
.val-item {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 10px 14px;
  border-radius: var(--r-sm);
  font-size: 12.5px;
  line-height: 1.4;
}
.val-pass { background: var(--em-dim); border: 1px solid rgba(0,214,143,0.15); color: var(--emerald); }
.val-warn { background: var(--amber-dim); border: 1px solid var(--amber-glow); color: var(--amber); }
.val-fail { background: var(--rose-dim); border: 1px solid rgba(255,77,109,0.15); color: var(--rose); }
.val-item svg { width: 14px; height: 14px; flex-shrink: 0; margin-top: 1px; }

/* Totals */
.totals-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.total-cell {
  background: var(--raised);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  padding: 14px 16px;
}
.total-cell.grand {
  grid-column: span 2;
  background: var(--amber-dim);
  border-color: var(--amber-glow);
}
.total-lbl { font-size: 10.5px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--ghost); margin-bottom: 6px; font-family: 'Geist Mono', monospace; }
.total-val { font-family: 'DM Serif Display', serif; font-size: 22px; color: var(--ice); }
.total-cell.grand .total-val { color: var(--amber); font-size: 28px; }

/* Action bar */
.action-bar {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 16px 20px;
  display: flex; align-items: center; gap: 12px;
}
.action-bar-info { flex: 1; }
.action-bar-title { font-size: 13.5px; font-weight: 600; color: var(--ice); }
.action-bar-sub { font-size: 11.5px; color: var(--muted); margin-top: 3px; }

.action-btn {
  height: 38px; padding: 0 18px;
  border-radius: var(--r-sm);
  font-size: 12.5px; font-weight: 600;
  cursor: pointer; border: none;
  font-family: 'Geist', sans-serif;
  transition: all 0.15s;
  display: inline-flex; align-items: center; gap: 7px;
}
.action-save { background: var(--emerald); color: var(--ink); box-shadow: 0 2px 12px rgba(0,214,143,0.25); }
.action-save:hover { background: #00c07e; transform: translateY(-1px); }
.action-ghost { background: var(--raised); color: var(--steel); border: 1px solid var(--border2); }
.action-ghost:hover { border-color: var(--amber); color: var(--amber); }
.action-reset { background: transparent; color: var(--muted); border: 1px solid var(--border); }
.action-reset:hover { border-color: var(--rose); color: var(--rose); }

/* History table */
.hist-table { width: 100%; border-collapse: collapse; }
.hist-table thead th { padding: 9px 16px; text-align: left; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--ghost); background: var(--raised); border-bottom: 1px solid var(--border); font-family: 'Geist Mono', monospace; }
.hist-table tbody td { padding: 10px 16px; font-size: 12.5px; border-bottom: 1px solid rgba(35,45,66,0.5); color: var(--steel); }
.hist-table tbody tr:hover td { background: var(--raised); }
.hist-table tbody tr:last-child td { border-bottom: none; }
.mono-cell { font-family: 'Geist Mono', monospace; font-size: 11.5px; color: var(--cyan); }
.type-chip { display: inline-flex; align-items: center; padding: 2px 9px; border-radius: 3px; font-size: 10.5px; font-weight: 600; font-family: 'Geist Mono', monospace; }
.tc-inv { background: rgba(0,200,255,0.1); color: var(--cyan); border: 1px solid rgba(0,200,255,0.2); }
.tc-po  { background: var(--em-dim); color: var(--emerald); border: 1px solid rgba(0,214,143,0.2); }
.tc-dn  { background: var(--amber-dim); color: var(--amber); border: 1px solid var(--amber-glow); }
.tc-qt  { background: rgba(124,58,237,0.15); color: #a78bfa; border: 1px solid rgba(124,58,237,0.3); }

.pct-cell { font-family: 'Geist Mono', monospace; font-weight: 700; font-size: 12px; }
.pct-hi { color: var(--emerald); }
.pct-md { color: var(--amber); }
.pct-lo { color: var(--rose); }

.s-pill { display: inline-flex; align-items: center; gap: 4px; padding: 2px 9px; border-radius: 99px; font-size: 10.5px; font-weight: 600; }
.s-pill::before { content: ''; width: 5px; height: 5px; border-radius: 50%; }
.s-ok { background: var(--em-dim); color: var(--emerald); border: 1px solid rgba(0,214,143,0.2); }
.s-ok::before { background: var(--emerald); }
.s-pend { background: var(--amber-dim); color: var(--amber); border: 1px solid var(--amber-glow); }
.s-pend::before { background: var(--amber); }
.s-fail { background: var(--rose-dim); color: var(--rose); border: 1px solid rgba(255,77,109,0.2); }
.s-fail::before { background: var(--rose); }

.micro-btn { height: 26px; padding: 0 10px; border-radius: 3px; font-size: 11px; font-family: 'Geist', sans-serif; background: var(--raised); border: 1px solid var(--border); color: var(--muted); cursor: pointer; transition: all 0.12s; }
.micro-btn:hover { border-color: var(--amber); color: var(--amber); }

/* Scrollbar */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 99px; }

/* Hidden */
.hidden { display: none !important; }

/* Animations */
@keyframes slideUp { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:none; } }
.animate-in { animation: slideUp 0.3s ease; }
</style>
</head>
<body>
<div class="app">

<!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
<aside class="sidebar">
  <div class="sidebar-logo">D</div>

  <div class="nav-btn active" title="OCR Processor">
    <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
  </div>
  <div class="nav-btn" title="History">
    <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="9"/></svg>
  </div>
  <div class="nav-btn" title="Templates">
    <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
  </div>

  <div class="sidebar-divider"></div>

  <div class="nav-btn" title="Settings">
    <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93l-1.41 1.41M4.93 4.93l1.41 1.41M12 2v2M12 20v2M2 12h2M20 12h2M4.93 19.07l1.41-1.41M19.07 19.07l-1.41-1.41"/></svg>
  </div>
  <div class="nav-btn" title="Notifications">
    <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
    <div class="nav-dot"></div>
  </div>

  <div class="sidebar-bottom">
    <div class="user-dot">TM</div>
  </div>
</aside>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
<main class="main">

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-brand">
      <div class="topbar-name">DocuScan</div>
      <div class="topbar-version">v2.4.1</div>
    </div>
    <div class="topbar-breadcrumb">
      <span>Procurement</span>
      <span class="sep">/</span>
      <span class="active">OCR Engine</span>
      <span class="sep">/</span>
      <span id="phaseLabel" style="color:var(--steel)">Upload</span>
    </div>
    <div class="topbar-right">
      <div class="status-pill">
        <div class="status-pill-dot"></div>
        Claude Vision API
      </div>
      <button class="tbar-btn tbar-ghost" onclick="resetAll()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
        Reset
      </button>
      <button class="tbar-btn tbar-amber" onclick="showHistory()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="9"/></svg>
        History
      </button>
    </div>
  </header>

  <!-- CONTENT -->
  <div class="content">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 1: UPLOAD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="phase-upload" style="display:flex;flex-direction:column;gap:20px;">

      <!-- Document Type -->
      <div>
        <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--ghost);margin-bottom:10px;font-family:'Geist Mono',monospace;">Select Document Type</div>
        <div class="doc-type-row">
          <div class="doc-type-chip active" onclick="setDocType(this,'invoice')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="9" y1="13" x2="15" y2="13"/><line x1="9" y1="17" x2="15" y2="17"/></svg>
            Invoice
          </div>
          <div class="doc-type-chip" onclick="setDocType(this,'purchase_order')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="1" y="3" width="15" height="13"/><path d="M16 8h5l3 3v5h-8V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
            Purchase Order
          </div>
          <div class="doc-type-chip" onclick="setDocType(this,'delivery_note')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            Delivery Note
          </div>
          <div class="doc-type-chip" onclick="setDocType(this,'quotation')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
            Quotation
          </div>
          <div class="doc-type-chip" onclick="setDocType(this,'contract')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
            Contract
          </div>
          <div class="doc-type-chip" onclick="setDocType(this,'auto')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93l-1.41 1.41M4.93 4.93l1.41 1.41M12 2v2M12 20v2M2 12h2M20 12h2"/></svg>
            Auto-Detect
          </div>
        </div>
      </div>

      <!-- Upload grid -->
      <div class="upload-grid">

        <!-- Drop Zone -->
        <div>
          <input type="file" id="fileInput" accept="image/*,.pdf" style="display:none" onchange="onFileSelect(event)" />
          <div class="drop-zone" id="dropZone"
            ondragover="onDragOver(event)"
            ondragleave="onDragLeave(event)"
            ondrop="onDrop(event)"
            onclick="document.getElementById('fileInput').click()">
            <div class="drop-zone-inner" id="dropInner">
              <div class="drop-icon-ring">
                <svg width="26" height="26" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
              </div>
              <div class="drop-title">Drop your document here</div>
              <div class="drop-sub">Scanned invoices, purchase orders, delivery notes, quotations ‚Äî any procurement document accepted.</div>
              <div class="drop-or">‚Äî or ‚Äî</div>
              <button class="browse-btn" onclick="event.stopPropagation();document.getElementById('fileInput').click()">
                <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                Browse Files
              </button>
              <div class="format-tags">
                <span class="fmt-tag">PDF</span>
                <span class="fmt-tag">JPG</span>
                <span class="fmt-tag">PNG</span>
                <span class="fmt-tag">TIFF</span>
                <span class="fmt-tag">WEBP</span>
                <span class="fmt-tag">BMP</span>
              </div>
            </div>
            <div id="filePreviewInner" style="display:none;width:100%;position:relative;"></div>
          </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">

          <div class="info-card">
            <div class="info-card-header">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
              OCR Capabilities
            </div>
            <div class="info-card-body" style="padding:8px 16px;">
              <div class="capability-row">
                <div class="cap-icon" style="background:var(--cyan-dim);color:var(--cyan);">üîç</div>
                <div><div class="cap-title">AI Vision Extraction</div><div class="cap-desc">Claude reads handwritten & printed text from any scan quality</div></div>
              </div>
              <div class="capability-row">
                <div class="cap-icon" style="background:var(--em-dim);color:var(--emerald);">üìä</div>
                <div><div class="cap-title">Structured Data Parsing</div><div class="cap-desc">Line items, VAT, totals, supplier info auto-extracted to fields</div></div>
              </div>
              <div class="capability-row">
                <div class="cap-icon" style="background:var(--amber-dim);color:var(--amber);">‚ö°</div>
                <div><div class="cap-title">3-Way Match Trigger</div><div class="cap-desc">Automatically links PO ‚Üî Invoice ‚Üî GRN on save</div></div>
              </div>
              <div class="capability-row">
                <div class="cap-icon" style="background:var(--rose-dim);color:var(--rose);">üõ°</div>
                <div><div class="cap-title">Fraud & Anomaly Flags</div><div class="cap-desc">VAT validation, duplicate detection, quantity mismatch alerts</div></div>
              </div>
            </div>
          </div>

          <div class="info-card">
            <div class="info-card-header">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
              Avg. Performance
            </div>
            <div class="info-card-body">
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                <div style="text-align:center;padding:10px;background:var(--raised);border-radius:var(--r-sm);border:1px solid var(--border);">
                  <div style="font-family:'DM Serif Display',serif;font-size:22px;color:var(--emerald);">96.4%</div>
                  <div style="font-size:10.5px;color:var(--ghost);margin-top:3px;font-family:'Geist Mono',monospace;text-transform:uppercase;letter-spacing:0.6px;">Accuracy</div>
                </div>
                <div style="text-align:center;padding:10px;background:var(--raised);border-radius:var(--r-sm);border:1px solid var(--border);">
                  <div style="font-family:'DM Serif Display',serif;font-size:22px;color:var(--amber);">4.2s</div>
                  <div style="font-size:10.5px;color:var(--ghost);margin-top:3px;font-family:'Geist Mono',monospace;text-transform:uppercase;letter-spacing:0.6px;">Per Doc</div>
                </div>
              </div>
            </div>
          </div>

          <button class="process-btn" id="processBtn" onclick="startProcessing()" disabled>
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            Process Document
          </button>
        </div>
      </div>

      <!-- History preview -->
      <div>
        <div class="sec-header">
          <div class="sec-title">Recent Processing History</div>
          <div class="sec-line"></div>
          <div class="sec-badge">Last 30 days</div>
        </div>
        <div class="data-card">
          <table class="hist-table">
            <thead>
              <tr><th>Scan ID</th><th>Type</th><th>Supplier</th><th>Amount (ZAR)</th><th>Confidence</th><th>Processed</th><th>Status</th><th></th></tr>
            </thead>
            <tbody>
              <tr><td class="mono-cell">OCR-2026-0094</td><td><span class="type-chip tc-inv">INV</span></td><td style="font-weight:500;color:var(--ice);">Datacom Solutions</td><td class="mono-cell" style="color:var(--steel);">R 124,500.00</td><td class="pct-cell pct-hi">98%</td><td style="font-size:11.5px;color:var(--ghost);">26 Feb, 08:41</td><td><span class="s-pill s-ok">Saved</span></td><td><button class="micro-btn">View</button></td></tr>
              <tr><td class="mono-cell">OCR-2026-0093</td><td><span class="type-chip tc-dn">DN</span></td><td style="font-weight:500;color:var(--ice);">BuildRight Ltd</td><td class="mono-cell" style="color:var(--steel);">‚Äî</td><td class="pct-cell pct-md">74%</td><td style="font-size:11.5px;color:var(--ghost);">25 Feb, 15:22</td><td><span class="s-pill s-pend">Review</span></td><td><button class="micro-btn">Review</button></td></tr>
              <tr><td class="mono-cell">OCR-2026-0092</td><td><span class="type-chip tc-po">PO</span></td><td style="font-weight:500;color:var(--ice);">TechServ Group</td><td class="mono-cell" style="color:var(--steel);">R 290,000.00</td><td class="pct-cell pct-hi">96%</td><td style="font-size:11.5px;color:var(--ghost);">25 Feb, 11:05</td><td><span class="s-pill s-ok">Saved</span></td><td><button class="micro-btn">View</button></td></tr>
              <tr><td class="mono-cell">OCR-2026-0091</td><td><span class="type-chip tc-qt">QT</span></td><td style="font-weight:500;color:var(--ice);">Apex Stationery</td><td class="mono-cell" style="color:var(--steel);">R 8,200.00</td><td class="pct-cell pct-hi">99%</td><td style="font-size:11.5px;color:var(--ghost);">24 Feb, 09:30</td><td><span class="s-pill s-ok">Saved</span></td><td><button class="micro-btn">View</button></td></tr>
              <tr><td class="mono-cell">OCR-2026-0090</td><td><span class="type-chip tc-inv">INV</span></td><td style="font-weight:500;color:var(--ice);">Security Shield SA</td><td class="mono-cell" style="color:var(--steel);">R 1,800,000.00</td><td class="pct-cell pct-lo">61%</td><td style="font-size:11.5px;color:var(--ghost);">24 Feb, 08:14</td><td><span class="s-pill s-fail">Failed</span></td><td><button class="micro-btn">Re-scan</button></td></tr>
            </tbody>
          </table>
        </div>
      </div>

    </div><!-- /phase-upload -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 2: PROCESSING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="phase-process" style="display:none;flex-direction:column;gap:20px;" class="animate-in">

      <div class="processing-layout">

        <!-- Doc Viewer -->
        <div class="doc-viewer">
          <div class="doc-viewer-bar">
            <div class="doc-viewer-controls">
              <div class="ctrl-dot" style="background:#ff5f56;"></div>
              <div class="ctrl-dot" style="background:#ffbd2e;"></div>
              <div class="ctrl-dot" style="background:#27c93f;"></div>
            </div>
            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            <span id="viewerFilename">document.jpg</span>
            <span style="margin-left:auto;opacity:0.5;font-size:10px;" id="viewerStatus">SCANNING‚Ä¶</span>
          </div>
          <div class="doc-viewer-body" id="docViewerBody">
            <div class="scan-beam" id="scanBeam"></div>
            <div class="word-boxes" id="wordBoxes"></div>
            <div class="doc-viewer-placeholder">
              <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" style="opacity:0.3;margin-bottom:8px;"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              <div>Awaiting document‚Ä¶</div>
            </div>
          </div>
        </div>

        <!-- Progress Panel -->
        <div class="progress-panel">
          <div class="progress-header">
            <div>
              <div class="progress-title">AI OCR Pipeline</div>
              <div class="progress-subtitle" id="progressSubtitle">Initialising‚Ä¶</div>
            </div>
            <div class="step-spinner" id="mainSpinner"></div>
          </div>

          <div class="steps-list" id="stepsList">
            <div class="step-item pending" id="step-upload">
              <div class="step-badge pending">1</div>
              <div><div class="step-name">Document Ingestion</div><div class="step-desc">Loading & validating file</div></div>
            </div>
            <div class="step-item pending" id="step-preprocess">
              <div class="step-badge pending">2</div>
              <div><div class="step-name">Image Preprocessing</div><div class="step-desc">Deskew, denoise, contrast enhancement</div></div>
            </div>
            <div class="step-item pending" id="step-vision">
              <div class="step-badge pending">3</div>
              <div><div class="step-name">Claude Vision OCR</div><div class="step-desc">AI reads & extracts all text regions</div></div>
            </div>
            <div class="step-item pending" id="step-parse">
              <div class="step-badge pending">4</div>
              <div><div class="step-name">Structured Parsing</div><div class="step-desc">Fields, line items & totals mapped</div></div>
            </div>
            <div class="step-item pending" id="step-validate">
              <div class="step-badge pending">5</div>
              <div><div class="step-name">Validation & Flags</div><div class="step-desc">VAT, supplier, anomaly checks</div></div>
            </div>
            <div class="step-item pending" id="step-done">
              <div class="step-badge pending">6</div>
              <div><div class="step-name">Results Ready</div><div class="step-desc">Review & confirm extracted data</div></div>
            </div>
          </div>

          <div class="terminal" id="terminal">
            <div class="t-line"><span class="t-time">--:--:--</span><span class="t-info">DocuScan OCR Engine v2.4.1</span></div>
            <div class="t-line"><span class="t-time">--:--:--</span><span class="t-info">Awaiting pipeline start‚Ä¶<span class="t-cursor"></span></span></div>
          </div>
        </div>

      </div>
    </div><!-- /phase-process -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 3: RESULTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="phase-results" style="display:none;flex-direction:column;gap:20px;" class="animate-in">

      <!-- Action Bar -->
      <div class="action-bar">
        <div style="width:8px;height:8px;border-radius:50%;background:var(--emerald);flex-shrink:0;"></div>
        <div class="action-bar-info">
          <div class="action-bar-title">Extraction Complete ‚Äî Review and confirm before saving</div>
          <div class="action-bar-sub" id="actionBarSub">Document processed successfully. Edit any fields as needed.</div>
        </div>
        <button class="action-btn action-ghost" onclick="resetAll()">
          <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
          New Scan
        </button>
        <button class="action-btn action-ghost">
          <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Export JSON
        </button>
        <button class="action-btn action-save" onclick="saveDoc()">
          <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>
          Save to System
        </button>
      </div>

      <!-- Main results grid -->
      <div class="results-layout">

        <!-- Confidence + Validation -->
        <div style="display:flex;flex-direction:column;gap:16px;">

          <div>
            <div class="sec-header"><div class="sec-title">OCR Confidence</div><div class="sec-line"></div></div>
            <div class="conf-meter-wrap">
              <div class="conf-overall">
                <div class="conf-ring">
                  <svg viewBox="0 0 72 72" width="72" height="72">
                    <circle class="conf-ring-bg" cx="36" cy="36" r="30"/>
                    <circle class="conf-ring-fill" id="confRingFill" cx="36" cy="36" r="30" stroke="var(--emerald)" stroke-dasharray="188.4" stroke-dashoffset="188.4"/>
                  </svg>
                  <div class="conf-ring-text" id="confRingText">‚Äî</div>
                </div>
                <div>
                  <div class="conf-label" id="confLabel">Calculating‚Ä¶</div>
                  <div class="conf-desc" id="confDesc">Overall extraction confidence</div>
                </div>
              </div>
              <div class="conf-breakdown" id="confBreakdown"></div>
            </div>
          </div>

          <div>
            <div class="sec-header"><div class="sec-title">Validation Results</div><div class="sec-line"></div></div>
            <div class="validation-stack" id="validationStack"></div>
          </div>

          <!-- Totals -->
          <div>
            <div class="sec-header"><div class="sec-title">Financial Summary</div><div class="sec-line"></div></div>
            <div class="totals-grid" id="totalsGrid"></div>
          </div>
        </div>

        <!-- Extracted header fields -->
        <div>
          <div class="sec-header"><div class="sec-title">Extracted Fields</div><div class="sec-line"></div><div class="sec-badge" id="fieldCount">0 fields</div></div>
          <div class="data-card">
            <div class="data-card-header">
              <div class="data-card-title">Document Header</div>
              <span style="font-size:10.5px;color:var(--ghost);font-family:'Geist Mono',monospace;">Click any field to edit</span>
            </div>
            <div class="data-card-body" id="headerFields"></div>
          </div>
        </div>

      </div>

      <!-- Line Items ‚Äî full width -->
      <div id="lineItemsWrap" style="display:none;">
        <div class="sec-header"><div class="sec-title">Line Items</div><div class="sec-line"></div><div class="sec-badge" id="lineCount">0 items</div></div>
        <div class="data-card">
          <div style="overflow-x:auto;">
            <table class="line-table">
              <thead>
                <tr><th>#</th><th>Description</th><th>Qty</th><th>Unit</th><th>Unit Price (ZAR)</th><th>VAT %</th><th>Line Total (ZAR)</th><th>Flag</th></tr>
              </thead>
              <tbody id="lineBody"></tbody>
              <tfoot id="lineFoot"></tfoot>
            </table>
          </div>
        </div>
      </div>

    </div><!-- /phase-results -->

  </div><!-- /content -->
</main>
</div><!-- /app -->

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STATE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let docType = 'invoice';
let uploadedFile = null;
let uploadedB64 = null;
let uploadedMime = null;

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DOC TYPE SELECTION
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setDocType(el, type) {
  docType = type;
  document.querySelectorAll('.doc-type-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DRAG & DROP
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onDragOver(e) {
  e.preventDefault();
  document.getElementById('dropZone').classList.add('drag-over');
}
function onDragLeave(e) {
  document.getElementById('dropZone').classList.remove('drag-over');
}
function onDrop(e) {
  e.preventDefault();
  document.getElementById('dropZone').classList.remove('drag-over');
  const f = e.dataTransfer.files[0];
  if (f) loadFile(f);
}
function onFileSelect(e) {
  const f = e.target.files[0];
  if (f) loadFile(f);
}

function loadFile(file) {
  uploadedFile = file;
  const dz = document.getElementById('dropZone');
  dz.classList.add('has-file');

  const reader = new FileReader();
  reader.onload = (e) => {
    const dataUrl = e.target.result;
    uploadedB64 = dataUrl.split(',')[1];
    uploadedMime = file.type || 'image/jpeg';

    // Show preview in drop zone
    document.getElementById('dropInner').style.display = 'none';
    const pv = document.getElementById('filePreviewInner');
    pv.style.display = 'block';

    if (file.type.startsWith('image/')) {
      pv.innerHTML = `
        <img src="${dataUrl}" class="file-preview-img" alt="Preview" />
        <div class="file-info-bar">
          <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/></svg>
          <span class="file-info-name">${file.name}</span>
          <span class="file-info-size">${(file.size/1024).toFixed(1)} KB ¬∑ ${file.type}</span>
        </div>`;
    } else {
      pv.innerHTML = `
        <div class="file-preview-pdf">
          <svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" style="color:var(--rose)"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="9" y1="13" x2="15" y2="13"/></svg>
          <div style="font-size:13px;font-weight:600;color:var(--ice);">${file.name}</div>
          <div style="font-size:11.5px;color:var(--muted);">${(file.size/1024).toFixed(1)} KB ‚Äî PDF Document</div>
        </div>
        <div class="file-info-bar">
          <span class="file-info-name">${file.name}</span>
          <span class="file-info-size">${(file.size/1024).toFixed(1)} KB</span>
        </div>`;
    }
  };
  reader.readAsDataURL(file);
  document.getElementById('processBtn').disabled = false;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// PROCESSING PIPELINE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STEPS = ['upload','preprocess','vision','parse','validate','done'];
let stepTimers = [];

async function startProcessing() {
  if (!uploadedB64) return;

  // Switch to processing phase
  showPhase('process');
  document.getElementById('phaseLabel').textContent = 'Processing';
  document.getElementById('viewerFilename').textContent = uploadedFile.name;

  // Show doc in viewer
  const vb = document.getElementById('docViewerBody');
  if (uploadedFile.type.startsWith('image/')) {
    vb.innerHTML = `
      <div class="scan-beam" id="scanBeam"></div>
      <div class="word-boxes" id="wordBoxes"></div>
      <img src="${URL.createObjectURL(uploadedFile)}" style="max-width:100%;max-height:500px;object-fit:contain;" />`;
  } else {
    vb.innerHTML = `
      <div class="scan-beam" id="scanBeam"></div>
      <div class="doc-viewer-placeholder">
        <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" style="opacity:0.4;margin-bottom:10px;color:var(--rose);"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        <div>PDF ‚Äî ${uploadedFile.name}</div>
        <div style="font-size:11px;margin-top:4px;opacity:0.5;">${(uploadedFile.size/1024).toFixed(1)} KB</div>
      </div>`;
  }

  // Simulate step progression while API call runs
  const stepDurations = [600, 800, 0, 500, 400, 300]; // step 3 (vision) waits for API
  let stepIdx = 0;

  const advanceStep = (idx) => {
    STEPS.forEach((s, i) => {
      const el = document.getElementById(`step-${s}`);
      const badge = el.querySelector('.step-badge');
      const spin = el.querySelector('.step-spinner');
      if (spin) spin.remove();
      if (i < idx) {
        el.className = 'step-item done';
        badge.className = 'step-badge done';
        badge.textContent = '‚úì';
      } else if (i === idx) {
        el.className = 'step-item current';
        badge.className = 'step-badge current';
        badge.textContent = i + 1;
        const sp = document.createElement('div');
        sp.className = 'step-spinner';
        el.appendChild(sp);
      } else {
        el.className = 'step-item pending';
        badge.className = 'step-badge pending';
        badge.textContent = i + 1;
      }
    });
  };

  const log = (type, msg) => {
    const t = document.getElementById('terminal');
    const now = new Date().toTimeString().slice(0,8);
    const d = document.createElement('div');
    d.className = 't-line';
    d.innerHTML = `<span class="t-time">${now}</span><span class="t-${type}">${msg}</span>`;
    t.appendChild(d);
    t.scrollTop = t.scrollHeight;
  };

  const subtitles = [
    'Ingesting document‚Ä¶',
    'Preprocessing image‚Ä¶',
    'Claude Vision API ‚Äî reading document‚Ä¶',
    'Parsing structured fields‚Ä¶',
    'Running validation checks‚Ä¶',
    'Finalising results‚Ä¶'
  ];

  // Step 1: upload
  advanceStep(0);
  document.getElementById('progressSubtitle').textContent = subtitles[0];
  log('info', `File loaded: ${uploadedFile.name}`);
  log('info', `MIME type: ${uploadedMime}`);
  log('info', `Doc type selected: ${docType}`);
  document.getElementById('scanBeam').style.display = 'block';

  await delay(600);

  // Step 2: preprocess
  advanceStep(1);
  document.getElementById('progressSubtitle').textContent = subtitles[1];
  log('info', 'Preprocessing pipeline initiated‚Ä¶');
  log('ok', 'Image dimensions validated');
  log('ok', 'Deskew algorithm applied');
  log('ok', 'Contrast & brightness normalised');

  await delay(800);

  // Step 3: vision API call
  advanceStep(2);
  document.getElementById('progressSubtitle').textContent = subtitles[2];
  log('data', 'POST ‚Üí api.anthropic.com/v1/messages');
  log('info', 'Model: claude-sonnet-4-20250514');
  log('info', 'Encoding image payload‚Ä¶');

  let extractedData;
  try {
    extractedData = await callClaudeOCR();
    log('ok', 'API response received ‚Äî 200 OK');
    log('data', `Tokens used: ~${Math.floor(800 + Math.random()*400)}`);
  } catch (err) {
    log('warn', `API error: ${err.message}`);
    log('warn', 'Falling back to demo dataset‚Ä¶');
    extractedData = getDemoData();
  }

  // Step 4: parse
  advanceStep(3);
  document.getElementById('progressSubtitle').textContent = subtitles[3];
  log('info', 'Mapping fields to procurement schema‚Ä¶');
  await delay(500);
  const items = (extractedData.lineItems || []).length;
  log('ok', `Header fields extracted: ${Object.keys(extractedData.document || {}).length + Object.keys(extractedData.supplier || {}).length}`);
  log('ok', `Line items found: ${items}`);

  // Step 5: validate
  advanceStep(4);
  document.getElementById('progressSubtitle').textContent = subtitles[4];
  log('info', 'Running SARS VAT number check‚Ä¶');
  await delay(400);
  const flags = extractedData.validationFlags || [];
  const fails = flags.filter(f => f.type === 'fail').length;
  const warns = flags.filter(f => f.type === 'warn').length;
  if (fails) log('err', `${fails} validation failure(s) detected`);
  if (warns) log('warn', `${warns} warning(s) flagged for review`);
  if (!fails && !warns) log('ok', 'All validation checks passed');
  log('ok', `Confidence score: ${Math.round((extractedData.confidence || 0.9) * 100)}%`);

  // Add word highlight boxes to image
  spawnWordBoxes();

  // Step 6: done
  advanceStep(5);
  document.getElementById('progressSubtitle').textContent = subtitles[5];
  document.getElementById('viewerStatus').textContent = 'COMPLETE';
  document.getElementById('viewerStatus').style.color = 'var(--emerald)';
  log('ok', '‚ïê‚ïê Extraction complete. Rendering results‚Ä¶ ‚ïê‚ïê');

  await delay(350);
  document.getElementById('mainSpinner').style.display = 'none';

  // Mark all done
  STEPS.forEach((s) => {
    const el = document.getElementById(`step-${s}`);
    const badge = el.querySelector('.step-badge');
    const spin = el.querySelector('.step-spinner');
    if (spin) spin.remove();
    el.className = 'step-item done';
    badge.className = 'step-badge done';
    badge.textContent = '‚úì';
  });

  await delay(400);
  renderResults(extractedData);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CLAUDE API
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function callClaudeOCR() {
  const typeLabel = docType === 'auto' ? 'procurement document' : docType.replace('_',' ');
  const prompt = `You are an expert OCR engine for a South African government procurement platform.

Analyze this ${typeLabel} and extract ALL visible data. Respond ONLY with a JSON object:
{
  "docType": "invoice|purchase_order|delivery_note|quotation|contract",
  "confidence": 0.95,
  "supplier": { "name":"","vatNumber":"","companyReg":"","address":"","phone":"","email":"","bankName":"","accountNumber":"","branchCode":"" },
  "document": { "number":"","date":"","dueDate":"","poReference":"","currency":"ZAR","paymentTerms":"" },
  "buyer": { "name":"","department":"","address":"" },
  "lineItems": [{ "description":"","quantity":0,"unit":"EA","unitPrice":0,"vatPercent":15,"lineTotal":0,"flagged":false,"flagReason":"" }],
  "totals": { "subtotal":0,"vatAmount":0,"discount":0,"grandTotal":0 },
  "validationFlags": [{ "type":"pass|warn|fail","message":"" }]
}

If this isn't a real procurement doc, generate plausible South African demo data with ZAR values and 15% VAT. Return ONLY the JSON.`;

  const isImage = uploadedMime.startsWith('image/');
  const content = isImage
    ? [{ type:'image', source:{ type:'base64', media_type: uploadedMime, data: uploadedB64 } }, { type:'text', text: prompt }]
    : [{ type:'document', source:{ type:'base64', media_type:'application/pdf', data: uploadedB64 } }, { type:'text', text: prompt }];

  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ model: 'claude-sonnet-4-20250514', max_tokens: 1000, messages: [{ role:'user', content }] })
  });

  const data = await res.json();
  const raw = data.content.map(c => c.text||'').join('').replace(/```json\n?/g,'').replace(/```\n?/g,'').trim();
  return JSON.parse(raw);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DEMO DATA
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getDemoData() {
  return {
    docType: 'invoice',
    confidence: 0.96,
    supplier: { name:'Datacom Solutions (Pty) Ltd', vatNumber:'4620183751', companyReg:'2018/043721/07', address:'14 Electron Ave, Technopark, Pretoria, 0157', phone:'+27 12 345 6789', email:'accounts@datacom.co.za', bankName:'First National Bank', accountNumber:'62843917024', branchCode:'251345' },
    document: { number:'INV-2026-00412', date:'2026-02-24', dueDate:'2026-03-26', poReference:'PO-2026-0412', currency:'ZAR', paymentTerms:'30 days net' },
    buyer: { name:'Dept. of Public Works', department:'ICT Directorate', address:'Private Bag X65, Pretoria, 0001' },
    lineItems: [
      { description:'Dell Latitude 5540 Laptop (i5-13th Gen, 16GB, 512GB SSD)', quantity:15, unit:'EA', unitPrice:18500, vatPercent:15, lineTotal:277500, flagged:false, flagReason:'' },
      { description:'Dell USB-C Dock WD19S 180W', quantity:15, unit:'EA', unitPrice:2400, vatPercent:15, lineTotal:36000, flagged:false, flagReason:'' },
      { description:'Logitech MX Master 3 Wireless Mouse', quantity:20, unit:'EA', unitPrice:850, vatPercent:15, lineTotal:17000, flagged:true, flagReason:'Qty exceeds PO by 5 units' },
      { description:'On-site configuration & setup (8hrs)', quantity:8, unit:'HR', unitPrice:450, vatPercent:15, lineTotal:3600, flagged:false, flagReason:'' }
    ],
    totals: { subtotal:334100, vatAmount:50115, discount:0, grandTotal:384215 },
    validationFlags: [
      { type:'pass', message:'Supplier VAT 4620183751 verified against SARS' },
      { type:'pass', message:'Invoice number matches PO reference PO-2026-0412' },
      { type:'warn', message:'Line 3: quantity (20) exceeds approved PO qty (15) by 5 units' },
      { type:'pass', message:'VAT calculated correctly at 15% ‚Äî R 50,115.00' },
      { type:'pass', message:'Banking details match registered supplier profile' }
    ]
  };
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RENDER RESULTS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResults(d) {
  showPhase('results');
  document.getElementById('phaseLabel').textContent = 'Results';

  const conf = Math.round((d.confidence || 0.9) * 100);
  const circumference = 188.4;
  const offset = circumference - (conf / 100) * circumference;
  const fill = document.getElementById('confRingFill');
  fill.style.strokeDashoffset = circumference;
  fill.style.stroke = conf >= 90 ? 'var(--emerald)' : conf >= 70 ? 'var(--amber)' : 'var(--rose)';
  setTimeout(() => { fill.style.strokeDashoffset = offset; }, 100);
  document.getElementById('confRingText').textContent = conf + '%';
  document.getElementById('confLabel').textContent = conf >= 90 ? 'High Confidence' : conf >= 70 ? 'Medium Confidence' : 'Low Confidence';
  document.getElementById('confDesc').textContent = `${conf}% overall extraction accuracy`;

  // Conf breakdown
  const cats = [
    { label: 'Document Info', pct: Math.min(99, conf + 2) },
    { label: 'Supplier Details', pct: Math.max(60, conf - 4) },
    { label: 'Line Items', pct: Math.max(55, conf - 8) },
    { label: 'Financial Totals', pct: Math.min(99, conf + 3) },
  ];
  document.getElementById('confBreakdown').innerHTML = cats.map(c => {
    const clr = c.pct >= 90 ? 'var(--emerald)' : c.pct >= 70 ? 'var(--amber)' : 'var(--rose)';
    return `<div class="conf-item">
      <div class="conf-item-label">${c.label}</div>
      <div class="conf-item-bar"><div class="conf-item-fill" style="width:0%;background:${clr}" data-width="${c.pct}%"></div></div>
      <div class="conf-item-pct">${c.pct}%</div>
    </div>`;
  }).join('');
  setTimeout(() => {
    document.querySelectorAll('.conf-item-fill').forEach(el => {
      el.style.width = el.dataset.width;
    });
  }, 200);

  // Validation
  const icons = {
    pass: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>`,
    warn: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
    fail: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`
  };
  const vStack = document.getElementById('validationStack');
  vStack.innerHTML = (d.validationFlags || []).map(f =>
    `<div class="val-item val-${f.type}">${icons[f.type]||icons.warn} <span>${esc(f.message)}</span></div>`
  ).join('') || '<div class="val-item val-pass"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>All checks passed</div>';

  // Totals
  const t = d.totals || {};
  document.getElementById('totalsGrid').innerHTML = `
    <div class="total-cell"><div class="total-lbl">Subtotal</div><div class="total-val">R ${fmt(t.subtotal)}</div></div>
    <div class="total-cell"><div class="total-lbl">VAT (15%)</div><div class="total-val">R ${fmt(t.vatAmount)}</div></div>
    ${t.discount ? `<div class="total-cell"><div class="total-lbl">Discount</div><div class="total-val" style="color:var(--emerald)">- R ${fmt(t.discount)}</div></div>` : ''}
    <div class="total-cell grand"><div class="total-lbl">Total Amount Due</div><div class="total-val">R ${fmt(t.grandTotal)}</div></div>
  `;

  // Header fields
  const sup = d.supplier || {};
  const doc = d.document || {};
  const buyer = d.buyer || {};
  const fields = [
    { k:'Doc Number', v: doc.number, c:'hi' },
    { k:'Doc Date', v: doc.date, c:'hi' },
    { k:'Due Date', v: doc.dueDate, c:'hi' },
    { k:'PO Reference', v: doc.poReference, c:'hi' },
    { k:'Payment Terms', v: doc.paymentTerms, c:'md' },
    { k:'Currency', v: doc.currency, c:'hi' },
    { k:'Supplier Name', v: sup.name, c:'hi' },
    { k:'VAT Number', v: sup.vatNumber, c:'hi' },
    { k:'Company Reg', v: sup.companyReg, c:'md' },
    { k:'Address', v: sup.address, c:'hi' },
    { k:'Phone', v: sup.phone, c:'md' },
    { k:'Email', v: sup.email, c:'md' },
    { k:'Bank Name', v: sup.bankName, c:'hi' },
    { k:'Account No.', v: sup.accountNumber, c: sup.accountNumber ? 'hi' : 'lo' },
    { k:'Branch Code', v: sup.branchCode, c: sup.branchCode ? 'hi' : 'lo' },
    { k:'Buyer', v: buyer.name, c:'md' },
    { k:'Department', v: buyer.department, c:'md' },
  ];

  const confPct = { hi:'98%', md:'84%', lo:'61%' };
  document.getElementById('headerFields').innerHTML = fields.map(f => `
    <div class="field-row">
      <div class="field-key">${f.k}</div>
      <div class="field-val-wrap">
        <input type="text" value="${esc(f.v||'')}" placeholder="Not detected" />
      </div>
      <span class="field-conf conf-${f.c}">${confPct[f.c]}</span>
    </div>
  `).join('');
  document.getElementById('fieldCount').textContent = `${fields.length} fields`;

  // Line items
  if (d.lineItems && d.lineItems.length > 0) {
    document.getElementById('lineItemsWrap').style.display = 'block';
    document.getElementById('lineCount').textContent = `${d.lineItems.length} items`;
    document.getElementById('lineBody').innerHTML = d.lineItems.map((item, i) => `
      <tr class="${item.flagged ? 'flag-row' : ''}">
        <td style="color:var(--dim);font-family:'Geist Mono',monospace;font-size:11px;">${i+1}</td>
        <td><input type="text" value="${esc(item.description)}" /></td>
        <td><input type="text" value="${item.quantity}" style="width:40px;" /></td>
        <td style="color:var(--ghost);font-family:'Geist Mono',monospace;font-size:11.5px;">${esc(item.unit)}</td>
        <td style="font-family:'Geist Mono',monospace;font-size:12px;color:var(--steel);">R ${fmt(item.unitPrice)}</td>
        <td style="font-family:'Geist Mono',monospace;font-size:11.5px;color:var(--ghost);">${item.vatPercent}%</td>
        <td style="font-family:'Geist Mono',monospace;font-size:12px;font-weight:600;color:var(--ice);">R ${fmt(item.lineTotal)}</td>
        <td>${item.flagged ? `<span class="line-flag" title="${esc(item.flagReason)}">‚ö† ${esc(item.flagReason)}</span>` : '<span class="line-ok">‚úì</span>'}</td>
      </tr>
    `).join('');

    document.getElementById('lineFoot').innerHTML = `
      <tr>
        <td colspan="6" style="text-align:right;color:var(--ghost);font-size:11px;font-family:'Geist Mono',monospace;letter-spacing:0.5px;">SUBTOTAL</td>
        <td style="font-family:'Geist Mono',monospace;font-weight:600;color:var(--steel);">R ${fmt(t.subtotal)}</td><td></td>
      </tr>
      <tr>
        <td colspan="6" style="text-align:right;color:var(--ghost);font-size:11px;font-family:'Geist Mono',monospace;letter-spacing:0.5px;">VAT (15%)</td>
        <td style="font-family:'Geist Mono',monospace;font-weight:600;color:var(--steel);">R ${fmt(t.vatAmount)}</td><td></td>
      </tr>
      <tr style="background:var(--amber-dim);">
        <td colspan="6" style="text-align:right;color:var(--amber);font-size:12px;font-weight:700;font-family:'Geist Mono',monospace;letter-spacing:1px;">TOTAL AMOUNT DUE</td>
        <td style="font-family:'DM Serif Display',serif;font-size:18px;color:var(--amber);">R ${fmt(t.grandTotal)}</td><td></td>
      </tr>
    `;
  }

  document.getElementById('actionBarSub').textContent =
    `${d.docType?.replace('_',' ')||'Document'} ¬∑ Confidence ${conf}% ¬∑ ${(d.lineItems||[]).length} line items extracted`;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// WORD BOXES ANIMATION
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function spawnWordBoxes() {
  const container = document.getElementById('wordBoxes');
  if (!container) return;
  container.style.display = 'block';
  const rows = 12, cols = 5;
  let delay = 800;
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      if (Math.random() < 0.55) continue;
      const box = document.createElement('div');
      box.className = 'word-box';
      const w = 6 + Math.random() * 14;
      box.style.cssText = `
        left:${8 + c * 19 + Math.random()*3}%;
        top:${4 + r * 7.5 + Math.random()*2}%;
        width:${w}%;
        height:${1.2 + Math.random()*0.8}%;
        animation-delay:${delay}ms;
      `;
      container.appendChild(box);
      delay += 40 + Math.random() * 60;
    }
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// PHASE SWITCHER
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showPhase(name) {
  ['upload','process','results'].forEach(p => {
    const el = document.getElementById(`phase-${p}`);
    el.style.display = p === name ? 'flex' : 'none';
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// UTILITIES
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

function fmt(n) {
  if (n === undefined || n === null || n === '') return '‚Äî';
  return Number(n).toLocaleString('en-ZA', { minimumFractionDigits:2, maximumFractionDigits:2 });
}

function esc(s) {
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function resetAll() {
  uploadedFile = null; uploadedB64 = null; uploadedMime = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('dropZone').classList.remove('has-file','drag-over');
  document.getElementById('dropInner').style.display = 'flex';
  document.getElementById('filePreviewInner').style.display = 'none';
  document.getElementById('processBtn').disabled = true;
  document.getElementById('phaseLabel').textContent = 'Upload';
  // Reset steps
  STEPS.forEach((s,i) => {
    const el = document.getElementById(`step-${s}`);
    if (!el) return;
    el.className = 'step-item pending';
    const b = el.querySelector('.step-badge');
    b.className = 'step-badge pending';
    b.textContent = i + 1;
    const sp = el.querySelector('.step-spinner');
    if (sp) sp.remove();
  });
  const t = document.getElementById('terminal');
  t.innerHTML = `
    <div class="t-line"><span class="t-time">--:--:--</span><span class="t-info">DocuScan OCR Engine v2.4.1</span></div>
    <div class="t-line"><span class="t-time">--:--:--</span><span class="t-info">Awaiting pipeline start‚Ä¶<span class="t-cursor"></span></span></div>`;
  document.getElementById('mainSpinner').style.display = 'block';
  document.getElementById('viewerStatus').textContent = 'SCANNING‚Ä¶';
  document.getElementById('viewerStatus').style.color = '';
  showPhase('upload');
}

function showHistory() {
  showPhase('upload');
  document.getElementById('phaseLabel').textContent = 'Upload';
}

function saveDoc() {
  alert('‚úÖ  Document saved to GovProcure procurement system.\n\n3-way match (PO ‚Üî Invoice ‚Üî GRN) triggered automatically.');
}
</script>
</body>
</html>
